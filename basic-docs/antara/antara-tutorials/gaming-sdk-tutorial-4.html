<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tutorial: Flappy Bird | Komodo Documentation</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/developer-docsKMD_Mark_Black.png">
    <meta name="description" content="Please become familiar with the Getting Started tutorial before beginning this tutorial.">
    <meta name="image" content="https://docs.komodoplatform.com/flappy-bird-tutorial/komodo_icon.png">
    <meta name="twitter:title" content="Tutorial: Flappy Bird">
    <meta name="twitter:description" content="Please become familiar with the Getting Started tutorial before beginning this tutorial.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://docs.komodoplatform.com/flappy-bird-tutorial/komodo_icon.png">
    <meta name="twitter:url" content="https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/gaming-sdk-tutorial-4.html">
    <meta name="twitter:site" content="@komodoplatform">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Tutorial: Flappy Bird">
    <meta property="og:description" content="Please become familiar with the Getting Started tutorial before beginning this tutorial.">
    <meta property="og:image" content="https://docs.komodoplatform.com/flappy-bird-tutorial/komodo_icon.png">
    <meta property="og:url" content="https://docs.komodoplatform.com/basic-docs/antara/antara-tutorials/gaming-sdk-tutorial-4.html">
    <meta property="og:site_name" content="Komodo Documentation">
    <meta itemprop="name" content="Tutorial: Flappy Bird">
    <meta itemprop="description" content="Please become familiar with the Getting Started tutorial before beginning this tutorial.">
    <meta itemprop="image" content="https://docs.komodoplatform.com/flappy-bird-tutorial/komodo_icon.png">
    <link rel="preload" href="/developer-docs/assets/css/0.styles.c2288803.css" as="style"><link rel="preload" href="/developer-docs/assets/js/app.9ab3ad37.js" as="script"><link rel="preload" href="/developer-docs/assets/js/5.380bd526.js" as="script"><link rel="preload" href="/developer-docs/assets/js/3.9b0c7874.js" as="script"><link rel="preload" href="/developer-docs/assets/js/58.9fa16544.js" as="script"><link rel="prefetch" href="/developer-docs/assets/js/10.651f83c3.js"><link rel="prefetch" href="/developer-docs/assets/js/100.67a72d75.js"><link rel="prefetch" href="/developer-docs/assets/js/101.bc7f4bc8.js"><link rel="prefetch" href="/developer-docs/assets/js/102.5b1cee10.js"><link rel="prefetch" href="/developer-docs/assets/js/103.ad2ff72f.js"><link rel="prefetch" href="/developer-docs/assets/js/104.802a3fce.js"><link rel="prefetch" href="/developer-docs/assets/js/105.bfbb794a.js"><link rel="prefetch" href="/developer-docs/assets/js/106.76c5a4ba.js"><link rel="prefetch" href="/developer-docs/assets/js/107.a075b49e.js"><link rel="prefetch" href="/developer-docs/assets/js/108.a8424a10.js"><link rel="prefetch" href="/developer-docs/assets/js/109.1a60b37d.js"><link rel="prefetch" href="/developer-docs/assets/js/11.28626345.js"><link rel="prefetch" href="/developer-docs/assets/js/110.564c265f.js"><link rel="prefetch" href="/developer-docs/assets/js/111.abbeb43d.js"><link rel="prefetch" href="/developer-docs/assets/js/112.8acb4d9e.js"><link rel="prefetch" href="/developer-docs/assets/js/113.999a09e1.js"><link rel="prefetch" href="/developer-docs/assets/js/114.871a02f9.js"><link rel="prefetch" href="/developer-docs/assets/js/115.15f66981.js"><link rel="prefetch" href="/developer-docs/assets/js/116.cff021fb.js"><link rel="prefetch" href="/developer-docs/assets/js/117.65d9e62c.js"><link rel="prefetch" href="/developer-docs/assets/js/118.2ad138c9.js"><link rel="prefetch" href="/developer-docs/assets/js/119.7cab6ee7.js"><link rel="prefetch" href="/developer-docs/assets/js/12.139e176a.js"><link rel="prefetch" href="/developer-docs/assets/js/120.8553dbab.js"><link rel="prefetch" href="/developer-docs/assets/js/121.ac0ad69a.js"><link rel="prefetch" href="/developer-docs/assets/js/122.0b693f65.js"><link rel="prefetch" href="/developer-docs/assets/js/123.a249dceb.js"><link rel="prefetch" href="/developer-docs/assets/js/124.1a0982f0.js"><link rel="prefetch" href="/developer-docs/assets/js/125.d3124ec8.js"><link rel="prefetch" href="/developer-docs/assets/js/126.bf19340f.js"><link rel="prefetch" href="/developer-docs/assets/js/127.48d6b26c.js"><link rel="prefetch" href="/developer-docs/assets/js/128.a34e6fa0.js"><link rel="prefetch" href="/developer-docs/assets/js/129.07bb347c.js"><link rel="prefetch" href="/developer-docs/assets/js/13.777b9a6f.js"><link rel="prefetch" href="/developer-docs/assets/js/130.48b76fdb.js"><link rel="prefetch" href="/developer-docs/assets/js/131.7212f31c.js"><link rel="prefetch" href="/developer-docs/assets/js/132.8c68ac7c.js"><link rel="prefetch" href="/developer-docs/assets/js/133.e53b3650.js"><link rel="prefetch" href="/developer-docs/assets/js/134.d716b644.js"><link rel="prefetch" href="/developer-docs/assets/js/135.fb48dc86.js"><link rel="prefetch" href="/developer-docs/assets/js/136.af53c243.js"><link rel="prefetch" href="/developer-docs/assets/js/137.e27c8dbe.js"><link rel="prefetch" href="/developer-docs/assets/js/138.be9b78d8.js"><link rel="prefetch" href="/developer-docs/assets/js/139.ef100e02.js"><link rel="prefetch" href="/developer-docs/assets/js/14.e7a08411.js"><link rel="prefetch" href="/developer-docs/assets/js/140.dcb76eb5.js"><link rel="prefetch" href="/developer-docs/assets/js/141.93cbbce3.js"><link rel="prefetch" href="/developer-docs/assets/js/142.82273a7e.js"><link rel="prefetch" href="/developer-docs/assets/js/143.54d5d1ec.js"><link rel="prefetch" href="/developer-docs/assets/js/144.a058697d.js"><link rel="prefetch" href="/developer-docs/assets/js/145.dc891754.js"><link rel="prefetch" href="/developer-docs/assets/js/146.86bc1af4.js"><link rel="prefetch" href="/developer-docs/assets/js/147.91b5d111.js"><link rel="prefetch" href="/developer-docs/assets/js/148.32199648.js"><link rel="prefetch" href="/developer-docs/assets/js/149.81aac775.js"><link rel="prefetch" href="/developer-docs/assets/js/15.d5560e7b.js"><link rel="prefetch" href="/developer-docs/assets/js/150.1d18de29.js"><link rel="prefetch" href="/developer-docs/assets/js/151.aa648491.js"><link rel="prefetch" href="/developer-docs/assets/js/152.b44b3403.js"><link rel="prefetch" href="/developer-docs/assets/js/153.e650323b.js"><link rel="prefetch" href="/developer-docs/assets/js/154.2bda206d.js"><link rel="prefetch" href="/developer-docs/assets/js/155.bcde059d.js"><link rel="prefetch" href="/developer-docs/assets/js/156.0743b1a9.js"><link rel="prefetch" href="/developer-docs/assets/js/157.a45515c1.js"><link rel="prefetch" href="/developer-docs/assets/js/158.55c99efe.js"><link rel="prefetch" href="/developer-docs/assets/js/159.f77e8b60.js"><link rel="prefetch" href="/developer-docs/assets/js/16.4b83571e.js"><link rel="prefetch" href="/developer-docs/assets/js/160.7b145129.js"><link rel="prefetch" href="/developer-docs/assets/js/161.a01b70fd.js"><link rel="prefetch" href="/developer-docs/assets/js/162.c9aacb1d.js"><link rel="prefetch" href="/developer-docs/assets/js/163.eac78233.js"><link rel="prefetch" href="/developer-docs/assets/js/164.784960ee.js"><link rel="prefetch" href="/developer-docs/assets/js/165.4b4db925.js"><link rel="prefetch" href="/developer-docs/assets/js/166.3a4dc5e1.js"><link rel="prefetch" href="/developer-docs/assets/js/167.21f4f38f.js"><link rel="prefetch" href="/developer-docs/assets/js/168.4ba2a783.js"><link rel="prefetch" href="/developer-docs/assets/js/169.82f4b0f8.js"><link rel="prefetch" href="/developer-docs/assets/js/17.3b153b50.js"><link rel="prefetch" href="/developer-docs/assets/js/170.91cd7e36.js"><link rel="prefetch" href="/developer-docs/assets/js/171.b2c49a57.js"><link rel="prefetch" href="/developer-docs/assets/js/172.cd7932b7.js"><link rel="prefetch" href="/developer-docs/assets/js/173.a23117c8.js"><link rel="prefetch" href="/developer-docs/assets/js/174.8b150b6b.js"><link rel="prefetch" href="/developer-docs/assets/js/175.f6c4b4db.js"><link rel="prefetch" href="/developer-docs/assets/js/176.c882c40d.js"><link rel="prefetch" href="/developer-docs/assets/js/177.7809f4b1.js"><link rel="prefetch" href="/developer-docs/assets/js/178.78f8d57c.js"><link rel="prefetch" href="/developer-docs/assets/js/179.917c0e33.js"><link rel="prefetch" href="/developer-docs/assets/js/18.a3e6257a.js"><link rel="prefetch" href="/developer-docs/assets/js/180.82354160.js"><link rel="prefetch" href="/developer-docs/assets/js/181.985f1ead.js"><link rel="prefetch" href="/developer-docs/assets/js/182.b8b7f77d.js"><link rel="prefetch" href="/developer-docs/assets/js/183.57dce0cd.js"><link rel="prefetch" href="/developer-docs/assets/js/184.41ae5675.js"><link rel="prefetch" href="/developer-docs/assets/js/185.654465e2.js"><link rel="prefetch" href="/developer-docs/assets/js/186.3dc6ca73.js"><link rel="prefetch" href="/developer-docs/assets/js/187.b721abbe.js"><link rel="prefetch" href="/developer-docs/assets/js/188.d9595099.js"><link rel="prefetch" href="/developer-docs/assets/js/189.698d4c40.js"><link rel="prefetch" href="/developer-docs/assets/js/19.b88f7f86.js"><link rel="prefetch" href="/developer-docs/assets/js/190.c247d716.js"><link rel="prefetch" href="/developer-docs/assets/js/191.fa914417.js"><link rel="prefetch" href="/developer-docs/assets/js/192.782c27e0.js"><link rel="prefetch" href="/developer-docs/assets/js/193.ccb9a5df.js"><link rel="prefetch" href="/developer-docs/assets/js/194.f8e7a5dd.js"><link rel="prefetch" href="/developer-docs/assets/js/195.833e367a.js"><link rel="prefetch" href="/developer-docs/assets/js/196.e34a2d68.js"><link rel="prefetch" href="/developer-docs/assets/js/197.38a04ac1.js"><link rel="prefetch" href="/developer-docs/assets/js/198.02110afb.js"><link rel="prefetch" href="/developer-docs/assets/js/199.aad52b1b.js"><link rel="prefetch" href="/developer-docs/assets/js/20.b7080965.js"><link rel="prefetch" href="/developer-docs/assets/js/200.3c4b6d62.js"><link rel="prefetch" href="/developer-docs/assets/js/201.a28b5123.js"><link rel="prefetch" href="/developer-docs/assets/js/202.13a2b40a.js"><link rel="prefetch" href="/developer-docs/assets/js/203.e5bbaa1a.js"><link rel="prefetch" href="/developer-docs/assets/js/204.001c832d.js"><link rel="prefetch" href="/developer-docs/assets/js/205.4924f61f.js"><link rel="prefetch" href="/developer-docs/assets/js/206.0d9ce247.js"><link rel="prefetch" href="/developer-docs/assets/js/207.ea0b9b63.js"><link rel="prefetch" href="/developer-docs/assets/js/208.9cb664b5.js"><link rel="prefetch" href="/developer-docs/assets/js/209.9b915eba.js"><link rel="prefetch" href="/developer-docs/assets/js/21.d921b8da.js"><link rel="prefetch" href="/developer-docs/assets/js/210.8debd989.js"><link rel="prefetch" href="/developer-docs/assets/js/211.0018bff6.js"><link rel="prefetch" href="/developer-docs/assets/js/212.a40c1472.js"><link rel="prefetch" href="/developer-docs/assets/js/213.99664e72.js"><link rel="prefetch" href="/developer-docs/assets/js/214.55d1e7f9.js"><link rel="prefetch" href="/developer-docs/assets/js/215.c305d829.js"><link rel="prefetch" href="/developer-docs/assets/js/216.45aa1232.js"><link rel="prefetch" href="/developer-docs/assets/js/217.27e0bf11.js"><link rel="prefetch" href="/developer-docs/assets/js/218.442791e9.js"><link rel="prefetch" href="/developer-docs/assets/js/219.e1603523.js"><link rel="prefetch" href="/developer-docs/assets/js/22.adac8867.js"><link rel="prefetch" href="/developer-docs/assets/js/220.b34747ee.js"><link rel="prefetch" href="/developer-docs/assets/js/221.3fd27a1a.js"><link rel="prefetch" href="/developer-docs/assets/js/222.5d57bca3.js"><link rel="prefetch" href="/developer-docs/assets/js/223.ca558b87.js"><link rel="prefetch" href="/developer-docs/assets/js/224.b23baf34.js"><link rel="prefetch" href="/developer-docs/assets/js/225.b42fd6ce.js"><link rel="prefetch" href="/developer-docs/assets/js/226.83180614.js"><link rel="prefetch" href="/developer-docs/assets/js/227.44a5d53c.js"><link rel="prefetch" href="/developer-docs/assets/js/228.4fdf61ad.js"><link rel="prefetch" href="/developer-docs/assets/js/229.fa4f481d.js"><link rel="prefetch" href="/developer-docs/assets/js/23.269805b3.js"><link rel="prefetch" href="/developer-docs/assets/js/230.812a0964.js"><link rel="prefetch" href="/developer-docs/assets/js/231.8665de74.js"><link rel="prefetch" href="/developer-docs/assets/js/232.90ade1c3.js"><link rel="prefetch" href="/developer-docs/assets/js/233.19771bad.js"><link rel="prefetch" href="/developer-docs/assets/js/234.a95eddc4.js"><link rel="prefetch" href="/developer-docs/assets/js/235.a00daafa.js"><link rel="prefetch" href="/developer-docs/assets/js/236.d4fb4bcf.js"><link rel="prefetch" href="/developer-docs/assets/js/237.381f23e7.js"><link rel="prefetch" href="/developer-docs/assets/js/238.6d7192b0.js"><link rel="prefetch" href="/developer-docs/assets/js/239.34a366e6.js"><link rel="prefetch" href="/developer-docs/assets/js/24.918604f8.js"><link rel="prefetch" href="/developer-docs/assets/js/240.794f95b4.js"><link rel="prefetch" href="/developer-docs/assets/js/241.6abbedec.js"><link rel="prefetch" href="/developer-docs/assets/js/242.8e20e7cd.js"><link rel="prefetch" href="/developer-docs/assets/js/243.c77f9362.js"><link rel="prefetch" href="/developer-docs/assets/js/244.ae0ed36d.js"><link rel="prefetch" href="/developer-docs/assets/js/245.aa77685b.js"><link rel="prefetch" href="/developer-docs/assets/js/246.1cb1a4d1.js"><link rel="prefetch" href="/developer-docs/assets/js/247.45a20267.js"><link rel="prefetch" href="/developer-docs/assets/js/248.eca74554.js"><link rel="prefetch" href="/developer-docs/assets/js/249.4b13fe6c.js"><link rel="prefetch" href="/developer-docs/assets/js/25.84c2914f.js"><link rel="prefetch" href="/developer-docs/assets/js/250.847efa0c.js"><link rel="prefetch" href="/developer-docs/assets/js/251.910be56f.js"><link rel="prefetch" href="/developer-docs/assets/js/252.6f8e6de3.js"><link rel="prefetch" href="/developer-docs/assets/js/253.5e09cd0f.js"><link rel="prefetch" href="/developer-docs/assets/js/254.cada20da.js"><link rel="prefetch" href="/developer-docs/assets/js/255.62a05e39.js"><link rel="prefetch" href="/developer-docs/assets/js/256.f8e3f6ed.js"><link rel="prefetch" href="/developer-docs/assets/js/257.a4fc941b.js"><link rel="prefetch" href="/developer-docs/assets/js/258.3124629e.js"><link rel="prefetch" href="/developer-docs/assets/js/259.46226971.js"><link rel="prefetch" href="/developer-docs/assets/js/26.6f1090c9.js"><link rel="prefetch" href="/developer-docs/assets/js/27.dd471430.js"><link rel="prefetch" href="/developer-docs/assets/js/28.c18d3963.js"><link rel="prefetch" href="/developer-docs/assets/js/29.7e9dc308.js"><link rel="prefetch" href="/developer-docs/assets/js/30.189d7ab0.js"><link rel="prefetch" href="/developer-docs/assets/js/31.e48126b6.js"><link rel="prefetch" href="/developer-docs/assets/js/32.9d03ef8a.js"><link rel="prefetch" href="/developer-docs/assets/js/33.ba7d9c09.js"><link rel="prefetch" href="/developer-docs/assets/js/34.e3205e39.js"><link rel="prefetch" href="/developer-docs/assets/js/35.f0e0b000.js"><link rel="prefetch" href="/developer-docs/assets/js/36.b8819d9f.js"><link rel="prefetch" href="/developer-docs/assets/js/37.d9399717.js"><link rel="prefetch" href="/developer-docs/assets/js/38.1ad64722.js"><link rel="prefetch" href="/developer-docs/assets/js/39.f75bdb95.js"><link rel="prefetch" href="/developer-docs/assets/js/4.1e54b34c.js"><link rel="prefetch" href="/developer-docs/assets/js/40.64caa71c.js"><link rel="prefetch" href="/developer-docs/assets/js/41.0323512e.js"><link rel="prefetch" href="/developer-docs/assets/js/42.d95b275b.js"><link rel="prefetch" href="/developer-docs/assets/js/43.bbd8b55e.js"><link rel="prefetch" href="/developer-docs/assets/js/44.d70bd20d.js"><link rel="prefetch" href="/developer-docs/assets/js/45.37ba1caa.js"><link rel="prefetch" href="/developer-docs/assets/js/46.0809a2c6.js"><link rel="prefetch" href="/developer-docs/assets/js/47.0d10f3f3.js"><link rel="prefetch" href="/developer-docs/assets/js/48.47b26133.js"><link rel="prefetch" href="/developer-docs/assets/js/49.5248f98b.js"><link rel="prefetch" href="/developer-docs/assets/js/50.74a93913.js"><link rel="prefetch" href="/developer-docs/assets/js/51.4b369511.js"><link rel="prefetch" href="/developer-docs/assets/js/52.3a4fa5b9.js"><link rel="prefetch" href="/developer-docs/assets/js/53.612834e0.js"><link rel="prefetch" href="/developer-docs/assets/js/54.a07f5331.js"><link rel="prefetch" href="/developer-docs/assets/js/55.6383b5a5.js"><link rel="prefetch" href="/developer-docs/assets/js/56.074632a7.js"><link rel="prefetch" href="/developer-docs/assets/js/57.27ab0ff4.js"><link rel="prefetch" href="/developer-docs/assets/js/59.fa4a0007.js"><link rel="prefetch" href="/developer-docs/assets/js/6.acfdc883.js"><link rel="prefetch" href="/developer-docs/assets/js/60.f5c6524b.js"><link rel="prefetch" href="/developer-docs/assets/js/61.2d6407bb.js"><link rel="prefetch" href="/developer-docs/assets/js/62.5f69573e.js"><link rel="prefetch" href="/developer-docs/assets/js/63.68e8a9a7.js"><link rel="prefetch" href="/developer-docs/assets/js/64.4a8d19f9.js"><link rel="prefetch" href="/developer-docs/assets/js/65.229abe50.js"><link rel="prefetch" href="/developer-docs/assets/js/66.248ecf05.js"><link rel="prefetch" href="/developer-docs/assets/js/67.ebce68f6.js"><link rel="prefetch" href="/developer-docs/assets/js/68.c54deaf5.js"><link rel="prefetch" href="/developer-docs/assets/js/69.8dcc814a.js"><link rel="prefetch" href="/developer-docs/assets/js/7.c8f0707e.js"><link rel="prefetch" href="/developer-docs/assets/js/70.233633d1.js"><link rel="prefetch" href="/developer-docs/assets/js/71.4056a571.js"><link rel="prefetch" href="/developer-docs/assets/js/72.dd72db55.js"><link rel="prefetch" href="/developer-docs/assets/js/73.186bf072.js"><link rel="prefetch" href="/developer-docs/assets/js/74.e4700618.js"><link rel="prefetch" href="/developer-docs/assets/js/75.b37db10f.js"><link rel="prefetch" href="/developer-docs/assets/js/76.e660b02f.js"><link rel="prefetch" href="/developer-docs/assets/js/77.34d9b3a2.js"><link rel="prefetch" href="/developer-docs/assets/js/78.14446f1b.js"><link rel="prefetch" href="/developer-docs/assets/js/79.67b8f5c8.js"><link rel="prefetch" href="/developer-docs/assets/js/8.d370058e.js"><link rel="prefetch" href="/developer-docs/assets/js/80.6f26442b.js"><link rel="prefetch" href="/developer-docs/assets/js/81.3cb52c65.js"><link rel="prefetch" href="/developer-docs/assets/js/82.89912fe5.js"><link rel="prefetch" href="/developer-docs/assets/js/83.1bc4ed84.js"><link rel="prefetch" href="/developer-docs/assets/js/84.f0016929.js"><link rel="prefetch" href="/developer-docs/assets/js/85.c320c53d.js"><link rel="prefetch" href="/developer-docs/assets/js/86.cafe4f45.js"><link rel="prefetch" href="/developer-docs/assets/js/87.43d7216d.js"><link rel="prefetch" href="/developer-docs/assets/js/88.00e25dfd.js"><link rel="prefetch" href="/developer-docs/assets/js/89.85c58a40.js"><link rel="prefetch" href="/developer-docs/assets/js/9.fbc15945.js"><link rel="prefetch" href="/developer-docs/assets/js/90.98f4cc72.js"><link rel="prefetch" href="/developer-docs/assets/js/91.e78908ea.js"><link rel="prefetch" href="/developer-docs/assets/js/92.db483962.js"><link rel="prefetch" href="/developer-docs/assets/js/93.bcbf78c3.js"><link rel="prefetch" href="/developer-docs/assets/js/94.2e7d1efe.js"><link rel="prefetch" href="/developer-docs/assets/js/95.a37a20b7.js"><link rel="prefetch" href="/developer-docs/assets/js/96.94717cfb.js"><link rel="prefetch" href="/developer-docs/assets/js/97.3e2034ed.js"><link rel="prefetch" href="/developer-docs/assets/js/98.cd1eb28f.js"><link rel="prefetch" href="/developer-docs/assets/js/99.56479e2f.js"><link rel="prefetch" href="/developer-docs/assets/js/vendors~docsearch.740fd3d0.js">
    <link rel="stylesheet" href="/developer-docs/assets/css/0.styles.c2288803.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/developer-docs/" class="home-link router-link-active"><img src="/developer-docsKMD_Horiz_White.svg" alt="Komodo Documentation" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/developer-docs/basic-docs/start-here/outline-for-new-developers.html" class="nav-link">
  Start Here
</a></div><div class="nav-item"><a href="/developer-docs/basic-docs/smart-chains/introduction-to-smart-chain-documentation.html" class="nav-link">
  Smart Chain Essentials
</a></div><div class="nav-item"><a href="/developer-docs/basic-docs/antara/introduction-to-antara.html" class="nav-link">
  Antara Framework
</a></div><div class="nav-item"><a href="/developer-docs/basic-docs/atomicdex/introduction-to-atomicdex.html" class="nav-link">
  AtomicDEX
</a></div><div class="nav-item"><a href="/developer-docs/komodo/installation.html" class="nav-link">
  Komodo
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/developer-docs/cc-jl/introduction.html" class="nav-link">
  CC Book
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/notary/setup-Komodo-Notary-Node.html" class="nav-link">
  Notary Nodes
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/mmV1/introduction.html" class="nav-link">
  Marketmaker V1
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/basic-docs/smart-chains/smart-chain-setup/nspv.html" class="nav-link">
  nSPV
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/gui/agama/introduction.html" class="nav-link">
  Agama
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/qa/debug-Komodo.html" class="nav-link">
  QA and Testing
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/whitepaper/introduction.html" class="nav-link">
  Whitepaper
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Resources" class="dropdown-title"><span class="title">Resources</span> <span class="arrow down"></span></button> <button type="button" aria-label="Resources" class="mobile-dropdown-title"><span class="title">Resources</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/developer-docs/resources/list-all-KomodoPlatform-repos-links.html" class="nav-link">
  Komodo Platform
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/resources/third-party-repos-resources.html" class="nav-link">
  Third Party
</a></li></ul></div></div><div class="nav-item"><a href="https://komodoplatform.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  KomodoPlatform.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/komodoplatform/Documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/developer-docs/basic-docs/start-here/outline-for-new-developers.html" class="nav-link">
  Start Here
</a></div><div class="nav-item"><a href="/developer-docs/basic-docs/smart-chains/introduction-to-smart-chain-documentation.html" class="nav-link">
  Smart Chain Essentials
</a></div><div class="nav-item"><a href="/developer-docs/basic-docs/antara/introduction-to-antara.html" class="nav-link">
  Antara Framework
</a></div><div class="nav-item"><a href="/developer-docs/basic-docs/atomicdex/introduction-to-atomicdex.html" class="nav-link">
  AtomicDEX
</a></div><div class="nav-item"><a href="/developer-docs/komodo/installation.html" class="nav-link">
  Komodo
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/developer-docs/cc-jl/introduction.html" class="nav-link">
  CC Book
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/notary/setup-Komodo-Notary-Node.html" class="nav-link">
  Notary Nodes
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/mmV1/introduction.html" class="nav-link">
  Marketmaker V1
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/basic-docs/smart-chains/smart-chain-setup/nspv.html" class="nav-link">
  nSPV
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/gui/agama/introduction.html" class="nav-link">
  Agama
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/qa/debug-Komodo.html" class="nav-link">
  QA and Testing
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/whitepaper/introduction.html" class="nav-link">
  Whitepaper
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Resources" class="dropdown-title"><span class="title">Resources</span> <span class="arrow down"></span></button> <button type="button" aria-label="Resources" class="mobile-dropdown-title"><span class="title">Resources</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/developer-docs/resources/list-all-KomodoPlatform-repos-links.html" class="nav-link">
  Komodo Platform
</a></li><li class="dropdown-item"><!----> <a href="/developer-docs/resources/third-party-repos-resources.html" class="nav-link">
  Third Party
</a></li></ul></div></div><div class="nav-item"><a href="https://komodoplatform.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  KomodoPlatform.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/komodoplatform/Documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/developer-docs/basic-docs/antara/introduction-to-antara.html" class="sidebar-link">Introduction to Antara Documentation</a></li><li><a href="/developer-docs/basic-docs/antara/antara-setup/antara-customizations.html" class="sidebar-link">Antara Customizations</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Antara Tutorials</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Antara Modules</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tutorial-flappy-bird"><a href="#tutorial-flappy-bird" class="header-anchor">#</a> Tutorial: Flappy Bird</h1> <p>Please become familiar with the <a href="/developer-docs/basic-docs/antara/antara-tutorials/gaming-sdk-tutorial-0.html">Getting Started</a> tutorial before beginning this tutorial.</p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This tutorial guides the reader in creating a simple game of Flappy Bird in relation to Komodo technology.</p> <h2 id="set-up-the-executable-window-and-game-scene"><a href="#set-up-the-executable-window-and-game-scene" class="header-anchor">#</a> Set Up the Executable, Window, and Game Scene</h2> <p>Create a folder called <code>flappy-bird</code> for the project, and create a subfolder called <code>assets</code> inside.</p> <p>Within the <code>assets</code> folder create a <code>textures</code> subfolder for storing the <code>player.png</code> image.</p> <p>Also in the <code>assets</code> folder, create another subfolder called <code>data</code>, and within this, create two subfolders: <code>linux</code> and <code>osx</code> to store utility files required to install the game on targeted systems.</p> <h4 id="the-linux-folder"><a href="#the-linux-folder" class="header-anchor">#</a> The Linux Folder</h4> <p>In the <code>Linux</code> folder three files are required.</p> <ul><li>komodo_icon.png
<ul><li>(these are the icons of the game)</li></ul></li> <li>org.antara.gaming.sfml.flappybird.appdata.xml
<ul><li>(xml definition for the game)</li></ul></li> <li>org.antara.gaming.sfml.flappybird.desktop
<ul><li>(desktop file for Linux)</li></ul></li></ul> <p>Here is the icon of the game for the tutorials:</p> <div><img src="/flappy-bird-tutorial/komodo_icon.png"></div> <p>Here is the xml file:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desktop-application<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>org.antara.gaming.sfml.flappybird.desktop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>metadata_license</span><span class="token punctuation">&gt;</span></span>MIT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>metadata_license</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project_license</span><span class="token punctuation">&gt;</span></span>MIT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project_license</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>flappy-bird<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>flappy-bird tutorial antara gaming sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Written in c++17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>launchable</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desktop-id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>org.antara.gaming.sfml.flappybird.desktop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>launchable</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>homepage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>https://github.com/KomodoPlatform/antara-gaming-sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screenshots</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screenshot</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">&gt;</span></span>https://www.freedesktop.org/software/appstream/docs/images/scr-examples/geany-good.png<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screenshot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screenshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provides</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>org.antara.gaming.sfml.flappybird.desktop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>provides</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Here is the desktop file:</p> <div class="language- extra-class"><pre class="language-text"><code>[Desktop Entry]
Type=Application
Name=flappy-bird
Exec=flappy-bird
Icon=komodo_icon
Categories=Game;
</code></pre></div><h4 id="the-osx-folder"><a href="#the-osx-folder" class="header-anchor">#</a> The OSX Folder</h4> <p>The <code>OSX</code> folder requires four files.</p> <ul><li>kmd_logo.icns
<ul><li>(icon osx format of the game)</li></ul></li> <li>Packaging_CMakeDMGBackground.tif
<ul><li>(dmg image background)</li></ul></li> <li>Packaging_CMakeDMGSetup.scpt
<ul><li>(OSX Apple script for the packaging)</li></ul></li> <li>sfml_flappybird_install.cmake
<ul><li>(CMake script for the bundling)</li></ul></li></ul> <p><a href="/flappy-bird-tutorial/kmd_logo.icns">Click here</a> to download kmd_logo.icns.</p> <p><a href="/flappy-bird-tutorial/Packaging_CMakeDMGBackground.tif">Click here</a> to download Packaging_CMakeDMGBackground.tif.</p> <p>The AppleScript:</p> <div class="language-cmake extra-class"><pre class="language-cmake"><code>on run argv
  set image_name to item <span class="token number">1</span> of argv
  tell application <span class="token string">&quot;Finder&quot;</span>
  tell disk image_name
    -- wait for the image to finish mounting
    set open_attempts to <span class="token number">0</span>
    repeat while open_attempts &lt; <span class="token number">4</span>
      try
        open
          delay <span class="token number">1</span>
          set open_attempts to <span class="token number">5</span>
        close
      on error errStr number errorNumber
        set open_attempts to open_attempts + <span class="token number">1</span>
        delay <span class="token number">10</span>
      end try
    end repeat
    delay <span class="token number">5</span>
    -- open the image the first time and save a DS_Store with just
    -- background and icon setup
    open
      set current view of container window to icon view
      set theViewOptions to the icon view options of container window
      set background picture of theViewOptions to file <span class="token string">&quot;.background:background.tif&quot;</span>
      set arrangement of theViewOptions to not arranged
      set icon size of theViewOptions to <span class="token number">128</span>
      delay <span class="token number">5</span>
    close
    -- next setup the position of the app and Applications symlink
    -- plus hide all the window decorationPackaging_CMakeDMGBackground.tif
    open
      update without registering applications
      tell container window
        set sidebar width to <span class="token number">0</span>
        set statusbar visible to false
        set toolbar visible to false
        set the bounds to { <span class="token number">400</span>, <span class="token number">100</span>, <span class="token number">900</span>, <span class="token number">465</span> <span class="token punctuation">}</span>
        set position of item <span class="token string">&quot;flappy-bird.app&quot;</span> to { <span class="token number">133</span>, <span class="token number">200</span> <span class="token punctuation">}</span>
        set position of item <span class="token string">&quot;Applications&quot;</span> to { <span class="token number">378</span>, <span class="token number">200</span> <span class="token punctuation">}</span>
      end tell
      update without registering applications
      delay <span class="token number">5</span>
    close
    -- one last open and close to verify that everything looks correct
    open
      delay <span class="token number">5</span>
    close
  end tell
  delay <span class="token number">1</span>
end tell
end run
</code></pre></div><p>The CMake script:</p> <div class="language-cmake extra-class"><pre class="language-cmake"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">APPLE</span><span class="token punctuation">)</span>
    <span class="token keyword">set_target_properties</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span> <span class="token namespace">PROPERTIES</span>
            MACOSX_BUNDLE_BUNDLE_NAME <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span></span>&quot;</span>
            <span class="token property">RESOURCE</span> data/osx/<span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span>.icns
            MACOSX_BUNDLE_ICON_FILE <span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span>
            MACOSX_BUNDLE_SHORT_VERSION_STRING <span class="token number">0.0.1</span>
            MACOSX_BUNDLE_LONG_VERSION_STRING <span class="token number">0.0.1</span>
            <span class="token property">MACOSX_BUNDLE_INFO_PLIST</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/cmake/MacOSXBundleInfo.plist.in&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">add_custom_command</span><span class="token punctuation">(</span>TARGET <span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span>
            POST_BUILD COMMAND
            <span class="token punctuation">${</span><span class="token variable">CMAKE_INSTALL_NAME_TOOL</span><span class="token punctuation">}</span> -add_rpath <span class="token string">&quot;@executable_path/../Frameworks/&quot;</span>
            <span class="token punctuation">$&lt;</span>TARGET_FILE:<span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span><span class="token punctuation">&gt;</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">APPLE</span><span class="token punctuation">)</span>
    <span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS <span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span>
            <span class="token property">BUNDLE</span> DESTINATION . COMPONENT Runtime
            RUNTIME DESTINATION bin COMPONENT Runtime
            <span class="token punctuation">)</span>
    <span class="token comment"># Note Mac specific extension .app</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>APPS <span class="token string">&quot;\<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_INSTALL_PREFIX</span><span class="token punctuation">}</span></span>/<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span></span>.app&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># Directories to look for dependencies</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>DIRS <span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">install</span><span class="token punctuation">(</span>CODE <span class="token string">&quot;include(BundleUtilities)
    fixup_bundle(\&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">APPS</span><span class="token punctuation">}</span></span>\&quot; \&quot;\&quot; \&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">DIRS</span><span class="token punctuation">}</span></span>\&quot;)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_GENERATOR <span class="token string">&quot;DRAGNDROP&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_DMG_DS_STORE_SETUP_SCRIPT <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/data/osx/Packaging_CMakeDMGSetup.scpt&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_DMG_BACKGROUND_IMAGE <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/data/osx/Packaging_CMakeDMGBackground.tif&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>CPACK_PACKAGE_NAME <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span>CPack<span class="token punctuation">)</span>
<span class="token keyword">endif</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="other-build-files"><a href="#other-build-files" class="header-anchor">#</a> Other Build Files</h4> <p>In the <code>flappy-bird</code> directory, create a text file and save it as <code>CMakeLists.txt</code>.</p> <p>This file has the following items: the name of the project, the creation of the executable, a link to the SDK, moving of the assets, the C++ standard that will be used, and any extra modules required.</p> <p>Below is the <code>CMakeLists.txt</code> file.</p> <div class="language-cmake extra-class"><pre class="language-cmake"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">}</span> <span class="token operator">STREQUAL</span> <span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">message</span><span class="token punctuation">(</span>FATAL_ERROR <span class="token string">&quot;Prevented in-tree build. Please create a build directory outside of the source code and call cmake from there&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">##! Minimum version of the CMake.</span>
<span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.14</span><span class="token punctuation">)</span>
<span class="token comment">##! C++ Standard needed by the SDK is 17</span>
<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_STANDARD</span> <span class="token number">17</span><span class="token punctuation">)</span>
<span class="token comment">##! The Project title -- flappy-bird.</span>
<span class="token keyword">project</span><span class="token punctuation">(</span>flappy-bird DESCRIPTION <span class="token string">&quot;An awesome flappy-bird&quot;</span> LANGUAGES CXX <span class="token property">VERSION</span> <span class="token number">1.0.0</span><span class="token punctuation">)</span>
<span class="token comment">##! The SDK need's clang as main compiler.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">NOT</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_CXX_COMPILER_ID</span><span class="token punctuation">}</span></span>&quot;</span> <span class="token operator">STREQUAL</span> <span class="token string">&quot;Clang&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">NOT</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_CXX_COMPILER_ID</span><span class="token punctuation">}</span></span>&quot;</span> <span class="token operator">STREQUAL</span> <span class="token string">&quot;AppleClang&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">message</span><span class="token punctuation">(</span>FATAL_ERROR <span class="token string">&quot;Only Clang is supported (minimum LLVM 8.0)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">##! Inform the SDK if the machine is on Linux</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">CMAKE_SYSTEM_NAME</span><span class="token punctuation">}</span> <span class="token operator">STREQUAL</span> <span class="token string">&quot;Linux&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>LINUX <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token keyword">endif</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">##! Include the module from CMake for fetching dependencies</span>
<span class="token keyword">include</span><span class="token punctuation">(</span>FetchContent<span class="token punctuation">)</span>
<span class="token comment">##! Declare information about the dependance to fetch.</span>
<span class="token function">FetchContent_Declare</span><span class="token punctuation">(</span>
        antara-gaming-sdk
        URL https://github.com/KomodoPlatform/antara-gaming-sdk/archive/master.zip
<span class="token punctuation">)</span>
<span class="token comment">##! Set extra modules from the SDK to use -- the SFML module here</span>
<span class="token keyword">set</span><span class="token punctuation">(</span>USE_SFML_ANTARA_WRAPPER <span class="token boolean">ON</span><span class="token punctuation">)</span>
<span class="token comment">##! Fetch the dependence</span>
<span class="token function">FetchContent_MakeAvailable</span><span class="token punctuation">(</span>antara-gaming-sdk<span class="token punctuation">)</span>
<span class="token comment">##! Calling this macros provided by the sdk will, if the local machine runs Apple, init the environment for this OS (std::filesystem).</span>
<span class="token function">init_antara_env</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">##! Get basis assets (default fonts, etc)</span>
<span class="token function">get_resources_basics_assets</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">##! Osx bundle icon</span>
<span class="token keyword">set</span><span class="token punctuation">(</span>ICON<span class="token punctuation">)</span>
<span class="token function">configure_icon_osx</span><span class="token punctuation">(</span>data/osx/kmd_logo.icns ICON kmd_logo.icns<span class="token punctuation">)</span>
<span class="token comment">##! Create the executable with the project name</span>
<span class="token keyword">add_executable</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span> <span class="token property">MACOSX_BUNDLE</span> <span class="token punctuation">${</span>ICON<span class="token punctuation">}</span> flappy-bird.cpp<span class="token punctuation">)</span>
<span class="token comment">##! Linux assets</span>
<span class="token function">magic_game_app_image_generation</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/data/linux&quot;</span>
        <span class="token string">&quot;org.antara.gaming.sfml.flappybird.desktop&quot;</span>
        <span class="token string">&quot;org.antara.gaming.sfml.flappybirds.appdata.xml&quot;</span>
        <span class="token string">&quot;komodo_icon.png&quot;</span>
        flappy-bird
        AntaraFlappyBirdAppDir
        <span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span>/assets
        <span class="token punctuation">)</span>
<span class="token comment">##! Setting output directory</span>
<span class="token keyword">set_target_properties</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span>
        <span class="token namespace">PROPERTIES</span>
        <span class="token property">RUNTIME_OUTPUT_DIRECTORY</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span></span>/bin/&quot;</span>
        <span class="token punctuation">)</span>
<span class="token comment">##! Link the SDK modules to use to the executable</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span> <span class="token namespace">PUBLIC</span> <span class="token inserted class-name">antara::world</span> <span class="token inserted class-name">antara::sfml</span> <span class="token inserted class-name">antara::collisions</span><span class="token punctuation">)</span>
<span class="token comment">##! Move the assets</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">WIN32</span><span class="token punctuation">)</span>
    <span class="token keyword">file</span><span class="token punctuation">(</span>COPY assets DESTINATION <span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span>/bin/<span class="token punctuation">)</span>
    <span class="token function">ADD_CUSTOM_COMMAND</span><span class="token punctuation">(</span>TARGET <span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span> POST_BUILD
            COMMAND <span class="token punctuation">${</span><span class="token variable">CMAKE_COMMAND</span><span class="token punctuation">}</span> -E copy_directory <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">SFML_BINARY_DIR</span><span class="token punctuation">}</span></span>/lib&quot;</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span></span>/bin/&quot;</span>
            COMMENT <span class="token string">&quot;copying dlls …&quot;</span>
            <span class="token punctuation">$&lt;</span>TARGET_FILE_DIR:<span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span><span class="token punctuation">&gt;</span>
            <span class="token punctuation">)</span>
    <span class="token function">ADD_CUSTOM_COMMAND</span><span class="token punctuation">(</span>TARGET <span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span> POST_BUILD
            COMMAND <span class="token punctuation">${</span><span class="token variable">CMAKE_COMMAND</span><span class="token punctuation">}</span> -E copy <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">SFML_SOURCE_DIR</span><span class="token punctuation">}</span></span>/extlibs/bin/x64/openal32.dll&quot;</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span></span>/bin/openal32.dll&quot;</span>
            COMMENT <span class="token string">&quot;copying dlls …&quot;</span>
            <span class="token punctuation">$&lt;</span>TARGET_FILE_DIR:<span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span><span class="token punctuation">&gt;</span>
            <span class="token punctuation">)</span>
<span class="token keyword">endif</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">APPLE</span><span class="token punctuation">)</span>
    <span class="token keyword">file</span><span class="token punctuation">(</span>COPY assets DESTINATION <span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span>/bin/<span class="token punctuation">${</span><span class="token variable">PROJECT_NAME</span><span class="token punctuation">}</span>.app/Contents/Resources<span class="token punctuation">)</span>
<span class="token keyword">endif</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Create the input file for the application containing an empty main function (as below) and save the file as <code>flappy-bird.cpp</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The project tree should now be as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>./flappy-bird
├── assets
│  ├── config
│  │  └── game.config.maker.json
│  └── textures
│     └── player.png
│  └── fonts
│     └── sansation.ttf
├── CMakeLists.txt
├── data
│  ├── linux
│  │  ├── komodo_icon.png
│  │  ├── org.antara.gaming.sfml.flappybird.appdata.xml
│  │  └── org.antara.gaming.sfml.flappybird.desktop
│  └── osx
│     ├── kmd_logo.icns
│     ├── Packaging_CMakeDMGBackground.tif
│     ├── Packaging_CMakeDMGSetup.scpt
│     └── sfml_flappybird_install.cmake
└── flappy-bird.cpp
</code></pre></div><h2 id="create-a-game-world"><a href="#create-a-game-world" class="header-anchor">#</a> Create a Game World</h2> <p>To create a world representing the world of the game, start by including the following header file.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
</code></pre></div><p>Add a basic structure named <code>flappy_bird_world</code>.</p> <p>This inherits from the <code>antara::gaming::world::app</code> class.</p> <p>Use the namespace <code>antara::gaming</code> and <code>std::string_literals</code> for convenience.</p> <p>Declare the new object in the body of the main function. Replace its return value with the return value of the game, as returned by the <code>run</code> function of the <code>class world::app</code>.</p> <p>The following is the result.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="initiating-the-graphics"><a href="#initiating-the-graphics" class="header-anchor">#</a> Initiating the Graphics</h4> <p>To compile and execute the program at this point would result only in an infinite loop.</p> <p>Adding the graphics side of the application requires two modules: <code>antara::gaming::sfml::graphic_system</code> and <code>antara::gaming::sfml::input::system</code>. These have the following headers, respectively: <code>#include &lt;antara/gaming/sfml/graphic.system.hpp&gt;</code> and <code>#include &lt;antara/gaming/sfml/input.system.hpp&gt;</code>.</p> <p>In the body of the constructor of the class <code>flappy_bird_world</code> load the graphic system and initialize the input system with the window from the graphic system.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Game entry point</span>
<span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
    <span class="token comment">// Load the graphical system</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Load the input system with the window from the graphical system</span>
    system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Compiling and running now creates a black window, which can be closed by pressing the close button on the window bar.</p> <div><img src="/flappy-bird-tutorial/black_window.png"></div> <h4 id="create-a-game-scene"><a href="#create-a-game-scene" class="header-anchor">#</a> Create a Game Scene</h4> <p>To create a game scene using the scene manager include the header file <code>#include &lt;antara/gaming/scenes/scene.manager.hpp&gt;</code> and load the scene's manager system into the system manager.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Game entry point</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">//! the game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Create the <code>game_scene</code> class that inherits from the <code>base_scene</code> class. This class is the entry point of the game scene.</p> <p>The concrete class must override several functions such as <code>update</code>, and <code>scene_name</code>.</p> <p>Leave the <code>update</code> function empty for the time being.</p> <p>The <code>scene_name</code> function returns the name of the scene.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Load the game scene into the <code>scene_manager</code> using the <code>change_scene</code> member function.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//! The game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//! Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//! Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//! Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The sprite for the bird requires the <code>sfml::resources_system</code>. Include the header file <code>#include &lt;antara/gaming/sfml/resources.manager.hpp&gt;</code> and load this in the world constructor.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Compiling the game at this time still produces a black window, but this is now the game scene.</p> <div><img src="/flappy-bird-tutorial/black_window.png"></div> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>The scene system is a useful method to organize multiple screens of the game: <strong>introduction scene</strong>, <strong>game scene</strong>, <strong>end-of-game scene</strong>, etc.</p></div> <p>Here is the code at this stage of the tutorial.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="create-the-pipes"><a href="#create-the-pipes" class="header-anchor">#</a> Create the Pipes</h2> <p>The following steps add the pipes that kill the Flappy Bird whenenver they touch each other. In the image below, note the two pipes that have a gap between them. This is a <code>column</code>.</p> <div><img src="/flappy-bird-tutorial/fb_column.png"></div> <h4 id="create-the-structs"><a href="#create-the-structs" class="header-anchor">#</a> Create the Structs</h4> <p>Begin by developing the constant values. Keep these in a struct.</p> <p>Observe the following example.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Add this to the <code>registry</code> in the <code>game_scene</code> constructor.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Create a struct to represent a single <code>pipe</code>. Instead of using a sprite, create graphics with basic shapes.</p> <p>For example, a pipe has two parts: the <code>body</code> and the <code>cap</code>. The body is the long part of the pipe with a cap sitting at the tip. Both are green-rectangle entities, but with different sizes.</p> <p>Also, prepare a <code>destroy</code> function to destroy <code>body</code> and <code>cap</code> entities.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Two of these pipes together are called a <code>column</code>.</p> <p>Make another struct which uses the <code>struct pipe</code>.</p> <p>In this struct, one instance of the <code>pipe</code> is the <code>top_pipe</code>, the other is the <code>bottom_pipe</code>.</p> <p>Call the <code>destroy</code> function again, but this time the <code>destroy</code> function also has an entity parameter which will be the <code>column</code> entity itself.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="create-the-pipe-functions"><a href="#create-the-pipe-functions" class="header-anchor">#</a> Create the Pipe Functions</h4> <p>The first function returns a random number. This randomly positions the gap between the pipes. Use <code>std::random_device</code>, <code>std::mt19937</code>,  and <code>std::uniform_real_distribution&lt;float&gt;</code> to this effect.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Tag each entity with the <code>game_scene</code> name.</p> <p>Dynamic entities require a <code>dynamic</code> tag. This makes queries to dynamic entities easier when destroying entities at game reset.</p> <p>Since the tagging is repeated frequently, create a function to manage the tagging process. Adding this helper function to a namespace is convenient.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The creation of the pipes requires another function to obtain a random starting position for the gap. This informs the logic of the place to start and end the top pipe, to include the gap, and then start and end the bottom pipe.</p> <p>This function uses a few constants, such as <code>column_min</code> and <code>column_max</code>.</p> <p><code>column_min</code> is for the top limit, <code>0.2</code> of the canvas height.</p> <p><code>column_max</code> is for the bottom limit, <code>0.8</code> of the canvas height. Subtract <code>gap_height</code> from the <code>bottom_limit</code>, as this is the starting position (top position) of the gap.</p> <p>Once the limits are established, the function returns a random float value between the limits, using the random function defined previously.</p> <p>Add this function to the same namespace.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Returns a random gap start position Y</span>
<span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
    <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="construct-the-pipes"><a href="#construct-the-pipes" class="header-anchor">#</a> Construct the Pipes</h4> <p>The <code>create_pipe</code> function has <code>bool is_top, float pos_x, float gap_start_pos_y</code> parameters.</p> <p><code>is_top</code> indicates if this is the top pipe or the bottom.</p> <p><code>pos_x</code> is the horizontal position of the pipe.</p> <p><code>gap_start_pos_y</code> is the vertical start position of the gap, for example, the bottom edge of the top pipe.</p> <p>Retrieve <code>canvas_height</code> and the constants.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Retrieve constants</span>
<span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Recall that the pipe is comprised of two parts: the body and the cap.</p> <p>Construct the body first. This is a rectangle, and therefore needs a center position and size.</p> <p>To avoid complicated math, set the center of the rectangle at the screen edge.</p> <p>Half of the pipe will be out of the view, but this visual optimization may be ignored for the purposes of this example tutorial.</p> <p>The <code>X</code> value is <code>pos_x</code>, and the <code>Y</code> value is at the top of the screen, <code>0</code>, for the top pipe.</p> <p>For the bottom pipe, the <code>Y</code> value is at the bottom edge of the screen, which is <code>canvas_height</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// PIPE BODY</span>
<span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Body size however, is trickier. Size <code>X</code> is the column thickness, but size <code>Y</code> is different depending on whether the pipe in question is at the top or bottom of the screen.</p> <p>For the top pipe, the start of the gap <code>gap_start_pos_y</code> should be the bottom of the rectangle. Half size is <code>gap_start_pos_y</code>, as the center of the rectangle is at 0. Full size is <code>gap_start_pos_y \* 2.0f</code>.</p> <p>For the bottom pipe, the top of the rectangle is the end of the gap, <code>gap_start_pos_y + gap_height</code>. Half size is <code>canvas_height - (gap_start_pos_y + gap_height)</code>. Double this value for the full size: <code>(canvas_height - (gap_start_pos_y + constants.gap_height)) \* 2.0f</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Size X is the column thickness,</span>
<span class="token comment">// Size Y is the important part.</span>
<span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
<span class="token comment">//  Half size is gap_start_pos_y, since the center of the rectangle is 0.</span>
<span class="token comment">// If this is the bottom pipe, the top of the rectangle is located at gap_start_pos_y + gap_height</span>
<span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
<span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                        is_top <span class="token operator">?</span>
                        gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                        <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>To construct the rectangle entity, use the blueprint function <code>geometry::blueprint_rectangle</code> and feed <code>pipe_color</code> and <code>pipe_outline_color</code> (which includes line thickness information).</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="construct-the-cap-of-the-pipe"><a href="#construct-the-cap-of-the-pipe" class="header-anchor">#</a> Construct the Cap of the Pipe</h4> <p>The size of the cap is <code>column_thickness</code> plus <code>pipe_cap_extra_width</code>, as the cap is visually similar to the popular pipe design from Super Mario Brothers.</p> <p>The height is pre-defined as <code>pipe_cap_height</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// PIPE CAP</span>
<span class="token comment">// Prepare the pipe cap</span>
<span class="token comment">// The size of the cap is defined in constants</span>
math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The cap position is trickier. The <code>X</code> position is the same as the body, <code>body_pos.x()</code>, since the cap is centered. However, the <code>Y</code> position changes depending on whether the cap is for the top or bottom.</p> <p>If the cap is at the top, the bottom line of the cap is alligned with bottom of the body, or start of the gap, as this is the same line.</p> <p>Use the start of the gap minus half of the cap height, because the position is the center of the rectangle. This is defined as <code>gap_start_pos_y - constants.pipe_cap_height \* 0.5f</code>.</p> <p>For the the bottom cap, the bottom of the gap is the same line as the top of the cap. The bottom of the gap is the gap start position plus the gap height: <code>gap_start_pos_y + constants.gap_height</code>. Add half of the pipe height again to the shift the pipe down, since the position is the center of the cap and the top of the cap must be alligned with the top of the body.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
<span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                is_top <span class="token operator">?</span>
                                gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>To construct the rectangle entity, use the blueprint function <code>geometry::blueprint_rectangle</code> and feed <code>pipe_color</code> and <code>pipe_outline_color</code> once again, with the color set to the same color as the body.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Define the draw order to make the cap appear in front of the body. Use <code>graphics::layer</code>. The higher value is the front, the lower is the back. Set <code>cap</code> as <code>layer&lt;4&gt;</code> and <code>body</code> as <code>layer&lt;3&gt;</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Set layers, cap should be in front of body</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Tag both entities as <code>game_scene</code> and <code>dynamic</code> with the <code>tag_game_scene</code> function defined earlier. Return both inside <code>{ }</code> to automatically construct a <code>struct pipe</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Construct a pipe with the body and cap, and return it</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The completed function appears as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// PIPE BODY</span>
    <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
    transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Size X is the column thickness,</span>
    <span class="token comment">// Size Y is the important part.</span>
    <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
    <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
    <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
    <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
    <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
    math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                          is_top <span class="token operator">?</span>
                          gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                          <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                              constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// PIPE CAP</span>
    <span class="token comment">// Prepare the pipe cap</span>
    <span class="token comment">// Size of the cap is defined in constants</span>
    math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
    <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
    transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                   is_top <span class="token operator">?</span>
                                   gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                   gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Construct the cap</span>
    <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                             constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Set layers, cap should be in front of body</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Construct a pipe with body and cap and return it</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="create-a-pipe"><a href="#create-a-pipe" class="header-anchor">#</a> Create a Pipe</h4> <p>Use this functionality to build a full column (two pipes and a gap).</p> <p>Make the function <code>void create_column(entt::registry &amp;registry, float pos_x)</code> with a single parameter <code>pos_x</code> for the <code>X</code> position of the column.</p> <p>Start by creating an empty entity.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create a fresh entity for a new column</span>
<span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Obtain a random vertical position for the start of the gap with the function created earlier, <code>get_random_gap_start_pos</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Get a random gap start position Y, between pipes</span>
<span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Create <code>top_pipe</code> and <code>bottom_pipe</code> with the <code>create_pipe</code> function. The only parameter that varies is the <code>is_top</code> boolean  — true for the <code>top_pipe</code> and false for <code>bottom_pipe</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
<span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Construct a <code>struct column</code> with these two, tag it with <code>column</code> name, then use the <code>tag_game_scene</code> function to tag it with <code>game_scene</code> and <code>dynamic</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The completed function appears as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Factory to create single column</span>
<span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create a fresh entity for a new column</span>
    <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get a random gap start position Y, between pipes</span>
    <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
    <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Create a <code>create_columns</code> function to reuse this functionality.</p> <p>Begin by retrieving the constants.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Retrieve constants</span>
<span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Columns move towards the starting position of Flappy Bird from a distance. This animation requires a <code>column_start_distance</code> variable to add the offset. The animation also requires an additional <code>constants.column_thickness \* 2.0f</code> value to make sure the columns are out of the screen if <code>column_start_distance</code> is set as <code>canvas_width</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Spawn columns far away</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
</code></pre></div><p>Use the <code>create_column</code> function in a <code>for loop</code> to create more columns. For count, use the <code>column_count</code> constant. To add distance between every column use the counter <code>i</code> which increments by one, and multiply <code>i</code> with <code>column_distance</code> to put each column further than the previous column. Add the <code>column_pos_offset</code> offset, also.</p> <p>The loop appears as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create the columns</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
    <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
    <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The completed function appears as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Factory for creating a Flappy Bird columns</span>
<span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
    <span class="token comment">// Create the columns</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
        <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
        <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call this <code>create_columns</code> function at initialization.</p> <h4 id="dynamic-objects"><a href="#dynamic-objects" class="header-anchor">#</a> Dynamic Objects</h4> <p>Make an initialization function for dynamic objects.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
<span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call this in the <code>game_scene</code> constructor.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Set the constants that will be used in the program</span>
    registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create everything</span>
    <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The result is as follows.</p> <div><img src="/flappy-bird-tutorial/fb_column.png"></div> <p>Here is the code up to this point in the tutorial.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.layer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.canvas.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/math/vector.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.sprite.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Logic functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Returns a random gap start position Y</span>
    <span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
        <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Factory functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
    pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE BODY</span>
        <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
        transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is the column thickness,</span>
        <span class="token comment">// Size Y is the important part.</span>
        <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
        <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
        <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
        <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
        <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
        math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                              is_top <span class="token operator">?</span>
                              gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                              <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                                  constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE CAP</span>
        <span class="token comment">// Prepare the pipe cap</span>
        <span class="token comment">// Size of the cap is defined in constants</span>
        math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
        <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
        transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       is_top <span class="token operator">?</span>
                                       gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                       gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the cap</span>
        <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                                 constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set layers, cap should be in front of body</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct a pipe with body and cap and return it</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory to create single column</span>
    <span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a fresh entity for a new column</span>
        <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get a random gap start position Y, between pipes</span>
        <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
        <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird columns</span>
    <span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
            <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create everything</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
    <span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="the-creation-of-the-background"><a href="#the-creation-of-the-background" class="header-anchor">#</a> The Creation of the Background</h2> <p>Beautify the background by adding sky, ground, and grass.</p> <p>The following is the objective.</p> <div><img src="/flappy-bird-tutorial/fb_background.png"></div> <h4 id="create-the-sky"><a href="#create-the-sky" class="header-anchor">#</a> Create the Sky</h4> <p>Add the constants to the <code>struct flappy_bird_constants</code> thickness and colors.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Background</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> ground_thickness<span class="token punctuation">{</span><span class="token number">100.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> grass_thickness<span class="token punctuation">{</span><span class="token number">20.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> graphics<span class="token operator">::</span>color background_color<span class="token punctuation">{</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> graphics<span class="token operator">::</span>color ground_color<span class="token punctuation">{</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> graphics<span class="token operator">::</span>color grass_color<span class="token punctuation">{</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color grass_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Make a function called <code>create_background</code>.</p> <p>Retrieve the constants and canvas size:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Retrieve constants</span>
<span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Create the sky as a simple blue rectangle.</p> <p>The position is the center of the canvas.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Set the size of the rectangle to the whole canvas (other visual elements will appear in the foreground).</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// The size is the full canvas</span>
math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Use the <code>geometry::blueprint_rectangle</code> blueprint again and use <code>background_color</code> from defined constants.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Set the sky rectangle to appear at <code>layer&lt;1&gt;</code> and tag the rectangle with <code>game_scene</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The following is the entire sky creation snippet.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create Sky</span>
<span class="token punctuation">{</span>
    <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
    transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// The size is the full canvas</span>
    math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="create-the-grass"><a href="#create-the-grass" class="header-anchor">#</a> Create the Grass</h4> <p>Now we do the same thing, but for grass. X position is middle of the canvas, Y position is canvas height minus ground thickness because grass grows above the ground!</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
<span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Size <code>Y</code> is constant <code>grass_thickness</code> and Size <code>X</code> is full <code>canvas_width</code> plus the outline thickness, to hide the left and right edges of the ground.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Size X is full canvas but the height is defined in constants</span>
<span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Use <code>geometry::blueprint_rectangle</code> again and assign <code>layer&lt;3&gt;</code> to the rectangle, then tag it.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here is the completed grass creation snippet.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create Grass</span>
<span class="token punctuation">{</span>
    <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
    <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
    transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
    <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
    math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="create-the-ground"><a href="#create-the-ground" class="header-anchor">#</a> Create the Ground</h4> <p>The <code>X</code> position is the middle of the canvas and the height is the canvas height minus half of the ground thickness (because the position is the center of the rectangle).</p> <p>Size <code>X</code> is the canvas width, size <code>Y</code> is the ground thickness.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create Ground</span>
<span class="token punctuation">{</span>
    <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
    <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
    transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
    math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div> <p>Notice that there are no tags for any of these <code>dynamic</code> objects. They are static and permanent.</p> <p>The background creation function appears as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Factory for creating a Flappy Bird background</span>
<span class="token keyword">void</span> <span class="token function">create_background</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create Sky</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
        transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// The size is the full canvas</span>
        math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create Grass</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
        <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
        transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
        <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
        math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                                                   constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create Ground</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
        <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
        transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
        math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call this function inside the <code>game_scene</code> constructor.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Set the constants that will be used in the program</span>
    registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create everything</span>
    <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The result is as follows.</p> <div><img src="/flappy-bird-tutorial/fb_background.png"></div> <p>Here is the full code up to this point of the tutorial.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.layer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.canvas.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/math/vector.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.sprite.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Background</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> ground_thickness<span class="token punctuation">{</span><span class="token number">100.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> grass_thickness<span class="token punctuation">{</span><span class="token number">20.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color background_color<span class="token punctuation">{</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color ground_color<span class="token punctuation">{</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color grass_color<span class="token punctuation">{</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color grass_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Logic functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Returns a random gap start position Y</span>
    <span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
        <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Factory functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
    pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE BODY</span>
        <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
        transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is the column thickness,</span>
        <span class="token comment">// Size Y is the important part.</span>
        <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
        <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
        <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
        <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
        <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
        math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                              is_top <span class="token operator">?</span>
                              gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                              <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                                  constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE CAP</span>
        <span class="token comment">// Prepare the pipe cap</span>
        <span class="token comment">// Size of the cap is defined in constants</span>
        math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
        <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
        transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       is_top <span class="token operator">?</span>
                                       gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                       gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the cap</span>
        <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                                 constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set layers, cap should be in front of body</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct a pipe with body and cap and return it</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory to create single column</span>
    <span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a fresh entity for a new column</span>
        <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get a random gap start position Y, between pipes</span>
        <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
        <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird column</span>
    <span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
            <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird background</span>
    <span class="token keyword">void</span> <span class="token function">create_background</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create Sky</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// The size is the full canvas</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Grass</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                                                       constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Ground</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create everything</span>
        <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
    <span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="move-destroy-and-respawn-pipes"><a href="#move-destroy-and-respawn-pipes" class="header-anchor">#</a> Move, Destroy, and Respawn Pipes</h2> <p>To create the illusion of movement, Flappy Bird stays still with respect to the horizontal axis and pipes move to the left. (This eliminates the need for a camera that follows the bird.)</p> <h4 id="moving-the-columns"><a href="#moving-the-columns" class="header-anchor">#</a> Moving the Columns</h4> <p>Define a constant to <code>flappy_bird_constants</code> named <code>scroll_speed</code>. This is the speed of movement of pipes.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">float</span> scroll_speed<span class="token punctuation">{</span><span class="token number">200.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Smooth movement requires a position update at every tick. This requires a <code>ecs::logic_update_system</code> value. Call this <code>column_logic</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Column Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">column_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">column_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Make a <code>move_pipe</code> function that accepts as a parameter a reference to a <code>struct pipe</code> object. Retrieve constants to access the scroll speed.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Move the pipe and return the x position</span>
<span class="token keyword">float</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> pipe <span class="token operator">&amp;</span>pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To move the pipe the logic needs to to know the pipe's current position. Retrieve the body position of the pipe (cap is also the same, so the body data is enough).</p> <p>Pipes move only along the X axis, horizontally.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Get current position of the pipe</span>
<span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Calculate the new position <code>X</code> by adding <code>scroll_speed</code>. Use the <code>-</code> operator, because a lower position value moves to the left side.</p> <p>Conceptually, this is the same as subtracting from the <code>X</code> position to make the pipe move towards the left side.</p> <p>Multiply <code>scroll_speed</code> with delta time <code>timer::time_step::get_fixed_delta_time()</code>, so that the movement occurs over time and the frame changes are smoother. <code>scroll_speed</code> is actually the amount of pixels the object moves in <code>1 second</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Shift pos X to the left by scroll_speed, but multiply the value by dt, as this occurs many times per second</span>
<span class="token comment">// Delta time ensures that the movement occurs over time, so that over the course of one second the movement covers scroll_speed pixels</span>
<span class="token keyword">auto</span> new_pos_x <span class="token operator">=</span> pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> constants<span class="token punctuation">.</span>scroll_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Update both body and cap positions by replacing entity’s <code>transform::position_2d</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Set the new position value</span>
registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Set cap position too</span>
<span class="token keyword">auto</span> cap_pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> cap_pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Return the new position.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Return the information about whether this pipe is out of the screen</span>
<span class="token keyword">return</span> new_pos_x<span class="token punctuation">;</span>
</code></pre></div><p>The completed function is now as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Move the pipe and return the x position</span>
<span class="token keyword">float</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> pipe <span class="token operator">&amp;</span>pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get current position of the pipe</span>
    <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Shift pos X to the left by scroll_speed, but multiply the value by dt, as this occurs many times per second</span>
    <span class="token comment">// Delta time ensures that the movement occurs over time, so that over the course of one second the movement covers scroll_speed pixels</span>
    <span class="token keyword">auto</span> new_pos_x <span class="token operator">=</span> pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> constants<span class="token punctuation">.</span>scroll_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Set the new position value</span>
    registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Set cap position too</span>
    <span class="token keyword">auto</span> cap_pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> cap_pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Return the information about whether this pipe is out of the screen</span>
    <span class="token keyword">return</span> new_pos_x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the update function move all the columns each tick. Those exiting the screen on the left are destroyed.</p> <p>A new column is spawned from the right side of the screen and is now the column furthest away from Flappy Bird.</p> <p>Create a function that returns the <code>X</code> position of the furthest pipe. This function loops over all columns and checks whether the column’s <code>X</code> position is higher than the previous maximum.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Find the furthest pipe's position X</span>
<span class="token keyword">float</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> furthest <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> x <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> furthest<span class="token punctuation">)</span> furthest <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> furthest<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The update function that is called ever tick retrieves constants and all columns, and loops all the columns.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update, this is called every tick</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Loop all columns</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>Inside the loop retrieve the <code>struct column</code> from the column <code>entt::entity</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Call the <code>move_pipe</code> function twice: one for the top pipe and one for the bottom. They are at the same X position, and this value is returned into the <code>column_pos_x</code> value.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Move pipes, and retrieve column position x</span>
<span class="token keyword">float</span> column_pos_x <span class="token operator">=</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="destroying-a-column-once-out-of-screen"><a href="#destroying-a-column-once-out-of-screen" class="header-anchor">#</a> Destroying a Column Once Out of Screen</h4> <p>The position of the left side of the screen is <code>0</code>.</p> <p>To make sure the column is out of the screen, use the <code>column_distance</code> value in the negative.</p> <p>For example, assume the value is <code>-400</code>. Compare the column’s <code>X</code> position against this value whether the column is outside the screen.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Test whether column is out of the screen</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>If the column is out of the screen, destroy it and create a new column on the right using the <code>create_column</code> function.</p> <p>For the new column position use the <code>furthest_pipe_position</code> value and add <code>column_distance</code> as this spawns further than the last column.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Test whether column is out of the screen</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Remove this column</span>
    col<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create a new column at far end</span>
    <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The completed <code>update</code> function is as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update, this will be called every tick</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Loop all columns</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Move pipes, and retrieve column position x</span>
        <span class="token keyword">float</span> column_pos_x <span class="token operator">=</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Test whether column is out of the screen</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Remove this column</span>
            col<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Create a new column at far end</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Name this logic system after the class.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>column_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>column_logic</code> class is fully ready.</p> <h4 id="create-the-logic-system"><a href="#create-the-logic-system" class="header-anchor">#</a> Create the Logic System</h4> <p>To create a logic system, access <code>ecs::system_manager</code> inside the <code>game_scene</code> and add a member variable to store the reference inside the <code>game_scene</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// System manager reference</span>
ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager_<span class="token punctuation">;</span>
</code></pre></div><p>Add a parameter to the constructor that sets this reference.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">system_manager_</span><span class="token punctuation">(</span>system_manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>Make a function to create logic systems and inside use the <code>system_manager_</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create logic systems</span>
<span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call this function in the <code>init_dynamic_objects</code> function.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
<span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token function">create_logic_systems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Below is the complete code of the tutorial up to this point.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.layer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.canvas.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/math/vector.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.sprite.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> scroll_speed<span class="token punctuation">{</span><span class="token number">200.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Background</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> ground_thickness<span class="token punctuation">{</span><span class="token number">100.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> grass_thickness<span class="token punctuation">{</span><span class="token number">20.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color background_color<span class="token punctuation">{</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color ground_color<span class="token punctuation">{</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color grass_color<span class="token punctuation">{</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color grass_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Logic functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Returns a random gap start position Y</span>
    <span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
        <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Factory functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
    pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE BODY</span>
        <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
        transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is the column thickness,</span>
        <span class="token comment">// Size Y is the important part.</span>
        <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
        <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
        <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
        <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
        <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
        math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                              is_top <span class="token operator">?</span>
                              gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                              <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                                  constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE CAP</span>
        <span class="token comment">// Prepare the pipe cap</span>
        <span class="token comment">// Size of the cap is defined in constants</span>
        math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
        <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
        transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       is_top <span class="token operator">?</span>
                                       gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                       gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the cap</span>
        <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                                 constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set layers, cap should be in front of body</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct a pipe with body and cap and return it</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory to create single column</span>
    <span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a fresh entity for a new column</span>
        <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get a random gap start position Y, between pipes</span>
        <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
        <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird columns</span>
    <span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
            <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird background</span>
    <span class="token keyword">void</span> <span class="token function">create_background</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create Sky</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// The size is the full canvas</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Grass</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                                                       constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Ground</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Column Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">column_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">column_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Loop all columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Move pipes, and retrieve column position x</span>
            <span class="token keyword">float</span> column_pos_x <span class="token operator">=</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Test whether column is out of the screen</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Remove this column</span>
                col<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Create a new column at far end</span>
                <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Find the furthest pipe's position X</span>
    <span class="token keyword">float</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> furthest <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> x <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> furthest<span class="token punctuation">)</span> furthest <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> furthest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Move the pipe and return the x position</span>
    <span class="token keyword">float</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> pipe <span class="token operator">&amp;</span>pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the pipe</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Shift pos X to the left by scroll_speed, but multiply the value by dt, as this occurs many times per second</span>
        <span class="token comment">// Delta time ensures that the movement occurs over time, so that over the course of one second the movement covers scroll_speed pixels</span>
        <span class="token keyword">auto</span> new_pos_x <span class="token operator">=</span> pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> constants<span class="token punctuation">.</span>scroll_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set cap position too</span>
        <span class="token keyword">auto</span> cap_pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> cap_pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Return the information about whether this pipe is out of the screen</span>
        <span class="token keyword">return</span> new_pos_x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>column_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">system_manager_</span><span class="token punctuation">(</span>system_manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create everything</span>
        <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
    <span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create logic systems</span>
        <span class="token function">create_logic_systems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// System manager reference</span>
    ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">,</span> system_manager_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="the-creation-of-flappy-bird"><a href="#the-creation-of-flappy-bird" class="header-anchor">#</a> The Creation of Flappy Bird</h2> <p>Create the Flappy Bird. Instead of using a rectangle as a character, use an image file. This is called a <code>character sprite</code>.</p> <p>From this point forward in the tutorial, the Flappy Bird is referred to as “player.”</p> <p>Two constants are required: one for the player position and another one for the image file name.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Player</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>string player_image_name<span class="token punctuation">{</span><span class="token string">&quot;player.png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> player_pos_x<span class="token punctuation">{</span><span class="token number">400.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Create a <code>create_player</code> function that constructs the player entity and returns it.</p> <p>Retrieve the constants, as before.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Factory for creating the player</span>
entt<span class="token operator">::</span>entity <span class="token function">create_player</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Use the <code>graphics::blueprint_sprite</code>. This requires two parameters: <code>graphics::sprite</code> and <code>transform::position_2d</code>.</p> <p>The <code>graphics::sprite</code> parameter receives the image path and <code>transform::position_2d</code> receives the <code>player_pos_x</code> constant as an <code>X</code> position and half of the canvas height as the <code>Y</code> position.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span> entity <span class="token operator">=</span> graphics<span class="token operator">::</span><span class="token function">blueprint_sprite</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span>
                                            graphics<span class="token operator">::</span>sprite<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_image_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                            transform<span class="token operator">::</span>position_2d<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_pos_x<span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Assign <code>layer&lt;5&gt;</code> for the draw order, and provide the tags <code>player</code>, <code>game_scene</code>, and <code>dynamic</code>.</p> <p>Return the entity.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>antara<span class="token operator">::</span>gaming<span class="token operator">::</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;player&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> entity<span class="token punctuation">;</span>
</code></pre></div><p>The completed <code>create_player</code> function is as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Factory for creating the player</span>
entt<span class="token operator">::</span>entity <span class="token function">create_player</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> entity <span class="token operator">=</span> graphics<span class="token operator">::</span><span class="token function">blueprint_sprite</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span>
                                             graphics<span class="token operator">::</span>sprite<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_image_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                             transform<span class="token operator">::</span>position_2d<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_pos_x<span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>antara<span class="token operator">::</span>gaming<span class="token operator">::</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;player&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call this function inside <code>init_dynamic_objects</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
<span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create player</span>
    <span class="token function">create_player</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token function">create_logic_systems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Compiling and executing the program now shows the character and moving pipes.</p> <div><img src="/flappy-bird-tutorial/fb_player_creation.png"></div> <p>Here is the full code up to this point of the tutorial.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.layer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.canvas.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/math/vector.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.sprite.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Player</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>string player_image_name<span class="token punctuation">{</span><span class="token string">&quot;player.png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> player_pos_x<span class="token punctuation">{</span><span class="token number">400.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> scroll_speed<span class="token punctuation">{</span><span class="token number">200.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Background</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> ground_thickness<span class="token punctuation">{</span><span class="token number">100.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> grass_thickness<span class="token punctuation">{</span><span class="token number">20.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color background_color<span class="token punctuation">{</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color ground_color<span class="token punctuation">{</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color grass_color<span class="token punctuation">{</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color grass_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Logic functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Returns a random gap start position Y</span>
    <span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
        <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Factory functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
    pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE BODY</span>
        <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
        transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is the column thickness,</span>
        <span class="token comment">// Size Y is the important part.</span>
        <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
        <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
        <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
        <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
        <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
        math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                              is_top <span class="token operator">?</span>
                              gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                              <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                                  constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE CAP</span>
        <span class="token comment">// Prepare the pipe cap</span>
        <span class="token comment">// Size of the cap is defined in constants</span>
        math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
        <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
        transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       is_top <span class="token operator">?</span>
                                       gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                       gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the cap</span>
        <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                                 constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set layers, cap should be in front of body</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct a pipe with body and cap and return it</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory to create single column</span>
    <span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a fresh entity for a new column</span>
        <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get a random gap start position Y, between pipes</span>
        <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
        <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird columns</span>
    <span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
            <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird background</span>
    <span class="token keyword">void</span> <span class="token function">create_background</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create Sky</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// The size is the full canvas</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Grass</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                                                       constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Ground</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating the player</span>
    entt<span class="token operator">::</span>entity <span class="token function">create_player</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> entity <span class="token operator">=</span> graphics<span class="token operator">::</span><span class="token function">blueprint_sprite</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span>
                                                 graphics<span class="token operator">::</span>sprite<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_image_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                 transform<span class="token operator">::</span>position_2d<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_pos_x<span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>antara<span class="token operator">::</span>gaming<span class="token operator">::</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;player&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Column Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">column_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">column_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Loop all columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Move pipes, and retrieve column position x</span>
            <span class="token keyword">float</span> column_pos_x <span class="token operator">=</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Test whether column is out of the screen</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Remove this column</span>
                col<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Create a new column at far end</span>
                <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Find the furthest pipe's position X</span>
    <span class="token keyword">float</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> furthest <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> x <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> furthest<span class="token punctuation">)</span> furthest <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> furthest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Move the pipe and return the x position</span>
    <span class="token keyword">float</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> pipe <span class="token operator">&amp;</span>pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the pipe</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Shift pos X to the left by scroll_speed, but multiply the value by dt, as this occurs many times per second</span>
        <span class="token comment">// Delta time ensures that the movement occurs over time, so that over the course of one second the movement covers scroll_speed pixels</span>
        <span class="token keyword">auto</span> new_pos_x <span class="token operator">=</span> pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> constants<span class="token punctuation">.</span>scroll_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set cap position too</span>
        <span class="token keyword">auto</span> cap_pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> cap_pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Return the information about whether this pipe is out of the screen</span>
        <span class="token keyword">return</span> new_pos_x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>column_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">system_manager_</span><span class="token punctuation">(</span>system_manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create everything</span>
        <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
    <span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create player</span>
        <span class="token function">create_player</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create logic systems</span>
        <span class="token function">create_logic_systems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// System manager reference</span>
    ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">,</span> system_manager_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="player-input-and-character-physics"><a href="#player-input-and-character-physics" class="header-anchor">#</a> Player Input and Character Physics</h2> <p>To receive input and create character physics begin by including two headers for input, <code>&lt;antara/gaming/input/virtual.hpp&gt;</code> and <code>&lt;antara/gaming/ecs/virtual.input.system.hpp&gt;</code>.</p> <p>The logic for this section also requires constants for physics.</p> <p><code>gravity</code> is the force which pulls the player down.</p> <p><code>jump_force</code> is the force which is applied instantly when the user presses the jump button.</p> <p><code>rotate_speed</code> is for the rotating animation.</p> <p><code>max_angle</code> is the rotation limit.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">float</span> gravity<span class="token punctuation">{</span><span class="token number">2000.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> jump_force<span class="token punctuation">{</span><span class="token number">650.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> rotate_speed<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> max_angle<span class="token punctuation">{</span><span class="token number">60.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Initialize the virtual input system and add a <code>jump</code> action.</p> <p>Keyboard keys are: <code>space</code>, <code>w</code>, <code>up</code>.</p> <p>Mouse buttons are <code>left</code> and <code>right</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create virtual input system</span>
system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>ecs<span class="token operator">::</span>virtual_input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Define the buttons for the jump action</span>
input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">,</span>
                                <span class="token punctuation">{</span>input<span class="token operator">::</span>key<span class="token operator">::</span>space<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>w<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>up<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token punctuation">{</span>input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>left<span class="token punctuation">,</span> input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>right<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Make another <code>ecs::logic_update_system</code> object, similar to <code>column_logic</code>, but this time for the player.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Player Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">player_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">player_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player_<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">player_</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Keep the player entity as a member.</p> <p>There is a 2D vector for movement speed, <code>math::vec2f</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">private</span><span class="token operator">:</span>
    entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
    math<span class="token operator">::</span>vec2f movement_speed_<span class="token punctuation">{</span><span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Make the update function to be called for every tick.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update, this will be called every tick</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get current position of the player</span>
    <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Gravity is acceleration. Instead of adding gravity to the position, add it to the movement speed. Multiply gravity with delta time to spread the change in value over time.</p> <p>Update <code>Y</code> of <code>movement_speed_</code> with <code>Y</code> plus gravity.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Add gravity to movement speed, multiply with delta time to apply it over time</span>
movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span>movement_speed_<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>gravity <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For the jump, check if the jump button is tapped.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Check if jump key is tapped</span>
<span class="token keyword">bool</span> jump_key_tapped <span class="token operator">=</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the jump button is tapped, set the <code>Y</code> value of <code>movement_speed_</code> as negative <code>jump_force</code>. Using this as a negative value here is effective as it acts as a reversal of the gravitational force.</p> <p>For this change, directly set the value instead of adding the value to the existing value. The reason for this is that this method prevents the player from spamming the jump button and infinitely speeding up.</p> <p>This also solves another problem. If the player is dropping more quickly than the jump button could counter, the method prevents a scenario where pressing the button only slows down the player's rate of descent, but does not reverse it.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// If jump is tapped, jump by adding jump force to the movement speed Y</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span> movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token operator">-</span>constants<span class="token punctuation">.</span>jump_force<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="moving-the-player-position"><a href="#moving-the-player-position" class="header-anchor">#</a> Moving the Player Position</h4> <p>Move the position with the movement speed. Multiplying the position with delta time, as always, to spread the change over time.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Add movement speed to position to make the character move, but apply over time with delta time</span>
pos <span class="token operator">+=</span> movement_speed_ <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Currently, the player can jump out of the screen. There must be a limit to the character position.</p> <p>If position <code>Y</code> is equal to or lower than zero, reset both positions and speed <code>Y</code> to <code>0</code>. This keeps the player inside, no matter how many times jump is pressed.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Do not let player to go out of the screen to top</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0.f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pos<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Set the modified position to the player entity.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Set the new position value</span>
registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="apply-rotation"><a href="#apply-rotation" class="header-anchor">#</a> Apply Rotation</h4> <p>Retrieve the properties of the player, add <code>rotate_speed</code> to the <code>props.rotation</code>, also apply delta time.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// ROTATION</span>
<span class="token comment">// Retrieve props of the player</span>
<span class="token keyword">auto</span> <span class="token operator">&amp;</span>props <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Increase the rotation a little by applying delta time</span>
<span class="token keyword">float</span> new_rotation <span class="token operator">=</span> props<span class="token punctuation">.</span>rotation <span class="token operator">+</span> constants<span class="token punctuation">.</span>rotate_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When the player jumps, reset the rotation so that the character is straight again before rotating downwards once more.</p> <p>Also, apply a <code>max_angle</code> limit to prevent excessive rotation.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// If jump button is tapped, reset rotation,</span>
<span class="token comment">// If rotation is higher than the max angle, set it to max angle</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span>
    new_rotation <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>rotation <span class="token operator">&gt;</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">)</span>
    new_rotation <span class="token operator">=</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">;</span>
</code></pre></div><p>Set the <code>transform::properties</code> to apply the rotation change.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Set the properties</span>
registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> transform<span class="token operator">::</span>properties<span class="token punctuation">{</span><span class="token punctuation">.</span>rotation <span class="token operator">=</span> new_rotation<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The following is the completed update function.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update, this will be called every tick</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get current position of the player</span>
    <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Add gravity to movement speed, multiply with delta time to apply it over time</span>
    movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span>movement_speed_<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>gravity <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Check if jump key is tapped</span>
    <span class="token keyword">bool</span> jump_key_tapped <span class="token operator">=</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If jump is tapped, jump by adding jump force to the movement speed Y</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span> movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token operator">-</span>constants<span class="token punctuation">.</span>jump_force<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Add movement speed to position to make the character move, but apply over time with delta time</span>
    pos <span class="token operator">+=</span> movement_speed_ <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Do not let player to go out of the screen to top</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0.f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pos<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Set the new position value</span>
    registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ROTATION</span>
    <span class="token comment">// Retrieve props of the player</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>props <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Increase the rotation a little by applying delta time</span>
    <span class="token keyword">float</span> new_rotation <span class="token operator">=</span> props<span class="token punctuation">.</span>rotation <span class="token operator">+</span> constants<span class="token punctuation">.</span>rotate_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If jump button is tapped, reset rotation,</span>
    <span class="token comment">// If rotation is higher than the max angle, set it to max angle</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span>
        new_rotation <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>rotation <span class="token operator">&gt;</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">)</span>
        new_rotation <span class="token operator">=</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">;</span>
    <span class="token comment">// Set the properties</span>
    registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> transform<span class="token operator">::</span>properties<span class="token punctuation">{</span><span class="token punctuation">.</span>rotation <span class="token operator">=</span> new_rotation<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Name this logic system after the class.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>player_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>player_logic</code> is ready to be used in the <code>game_scene</code>.</p> <p>In the earlier function, <code>create_logic_systems</code> create the <code>player_logic</code> function.</p> <p><code>player_logic</code> requires the <code>player</code> entity as an argument.</p> <p>Modify the function as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create logic systems</span>
<span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When the game is launched the physics is in a paused state. The game begins when the player pressed the jump button.</p> <p>Make two functions that enable and disable both logic functions.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Pause physics</span>
<span class="token keyword">void</span> <span class="token function">pause_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    system_manager_<span class="token punctuation">.</span>disable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Resume physics</span>
<span class="token keyword">void</span> <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    system_manager_<span class="token punctuation">.</span>enable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Use a boolean to indicate whether the player has started playing.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// States</span>
<span class="token keyword">bool</span> started_playing_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Add a function which resets this state value.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Reset state values</span>
<span class="token keyword">void</span> <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    started_playing_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the <code>init_dynamic_objects</code> function, feed the <code>player</code> entity to the <code>create_logic_systems</code> function, pause physics, and reset state variables.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
<span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create player</span>
    <span class="token keyword">auto</span> player <span class="token operator">=</span> <span class="token function">create_player</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Reset state variables</span>
    <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Check for a jump button press. This starts the game.</p> <p>Check only whether the player has not yet begun to play.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Check if start game is requested at the pause state</span>
<span class="token keyword">void</span> <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If game is not started yet and jump key is tapped</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started_playing_ <span class="token operator">&amp;&amp;</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Game starts, player started playing</span>
        started_playing_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call this function in the update function that is called every tick.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update the game every tick</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token comment">// Check if player requested to start the game</span>
    <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Here is the complete code up to this point in the tutorial.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/ecs/virtual.input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.layer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.canvas.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/math/vector.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.sprite.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/input/virtual.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Player</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>string player_image_name<span class="token punctuation">{</span><span class="token string">&quot;player.png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> player_pos_x<span class="token punctuation">{</span><span class="token number">400.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gravity<span class="token punctuation">{</span><span class="token number">2000.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> jump_force<span class="token punctuation">{</span><span class="token number">650.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> rotate_speed<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> max_angle<span class="token punctuation">{</span><span class="token number">60.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> scroll_speed<span class="token punctuation">{</span><span class="token number">200.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Background</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> ground_thickness<span class="token punctuation">{</span><span class="token number">100.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> grass_thickness<span class="token punctuation">{</span><span class="token number">20.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color background_color<span class="token punctuation">{</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color ground_color<span class="token punctuation">{</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color grass_color<span class="token punctuation">{</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color grass_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Logic functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Returns a random gap start position Y</span>
    <span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
        <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Factory functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
    pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE BODY</span>
        <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
        transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is the column thickness,</span>
        <span class="token comment">// Size Y is the important part.</span>
        <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
        <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
        <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
        <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
        <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
        math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                              is_top <span class="token operator">?</span>
                              gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                              <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                                  constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE CAP</span>
        <span class="token comment">// Prepare the pipe cap</span>
        <span class="token comment">// Size of the cap is defined in constants</span>
        math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
        <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
        transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       is_top <span class="token operator">?</span>
                                       gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                       gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the cap</span>
        <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                                 constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set layers, cap should be in front of body</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct a pipe with body and cap and return it</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory to create single column</span>
    <span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a fresh entity for a new column</span>
        <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get a random gap start position Y, between pipes</span>
        <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
        <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird columns</span>
    <span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
            <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird background</span>
    <span class="token keyword">void</span> <span class="token function">create_background</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create Sky</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// The size is the full canvas</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Grass</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                                                       constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Ground</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating the player</span>
    entt<span class="token operator">::</span>entity <span class="token function">create_player</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> entity <span class="token operator">=</span> graphics<span class="token operator">::</span><span class="token function">blueprint_sprite</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span>
                                                 graphics<span class="token operator">::</span>sprite<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_image_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                 transform<span class="token operator">::</span>position_2d<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_pos_x<span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>antara<span class="token operator">::</span>gaming<span class="token operator">::</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;player&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Column Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">column_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">column_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Loop all columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Move pipes, and retrieve column position x</span>
            <span class="token keyword">float</span> column_pos_x <span class="token operator">=</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Test whether column is out of the screen</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Remove this column</span>
                col<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Create a new column at far end</span>
                <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Find the furthest pipe's position X</span>
    <span class="token keyword">float</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> furthest <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> x <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> furthest<span class="token punctuation">)</span> furthest <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> furthest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Move the pipe and return the x position</span>
    <span class="token keyword">float</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> pipe <span class="token operator">&amp;</span>pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the pipe</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Shift pos X to the left by scroll_speed, but multiply the value by dt, as this occurs many times per second</span>
        <span class="token comment">// Delta time ensures that the movement occurs over time, so that over the course of one second the movement covers scroll_speed pixels</span>
        <span class="token keyword">auto</span> new_pos_x <span class="token operator">=</span> pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> constants<span class="token punctuation">.</span>scroll_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set cap position too</span>
        <span class="token keyword">auto</span> cap_pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> cap_pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Return the information about whether this pipe is out of the screen</span>
        <span class="token keyword">return</span> new_pos_x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>column_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Player Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">player_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">player_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">player_</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the player</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Add gravity to movement speed, multiply with delta time to apply it over time</span>
        movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span>movement_speed_<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>gravity <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if jump key is tapped</span>
        <span class="token keyword">bool</span> jump_key_tapped <span class="token operator">=</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If jump is tapped, jump by adding jump force to the movement speed Y</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span> movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token operator">-</span>constants<span class="token punctuation">.</span>jump_force<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Add movement speed to position to make the character move, but apply over time with delta time</span>
        pos <span class="token operator">+=</span> movement_speed_ <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Do not let player to go out of the screen to top</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0.f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pos<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ROTATION</span>
        <span class="token comment">// Retrieve props of the player</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>props <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Increase the rotation a little by applying delta time</span>
        <span class="token keyword">float</span> new_rotation <span class="token operator">=</span> props<span class="token punctuation">.</span>rotation <span class="token operator">+</span> constants<span class="token punctuation">.</span>rotate_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If jump button is tapped, reset rotation,</span>
        <span class="token comment">// If rotation is higher than the max angle, set it to max angle</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span>
            new_rotation <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>rotation <span class="token operator">&gt;</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">)</span>
            new_rotation <span class="token operator">=</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">;</span>
        <span class="token comment">// Set the properties</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> transform<span class="token operator">::</span>properties<span class="token punctuation">{</span><span class="token punctuation">.</span>rotation <span class="token operator">=</span> new_rotation<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
    math<span class="token operator">::</span>vec2f movement_speed_<span class="token punctuation">{</span><span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>player_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">system_manager_</span><span class="token punctuation">(</span>system_manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create everything</span>
        <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token comment">// Check if player requested to start the game</span>
        <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check if start game is requested at the pause state</span>
    <span class="token keyword">void</span> <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If game is not started yet and jump key is tapped</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started_playing_ <span class="token operator">&amp;&amp;</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Game starts, player started playing</span>
            started_playing_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
    <span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create player</span>
        <span class="token keyword">auto</span> player <span class="token operator">=</span> <span class="token function">create_player</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create logic systems</span>
        <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Reset state variables</span>
        <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Reset state values</span>
    <span class="token keyword">void</span> <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        started_playing_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Pause physics</span>
    <span class="token keyword">void</span> <span class="token function">pause_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>disable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Resume physics</span>
    <span class="token keyword">void</span> <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>enable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// System manager reference</span>
    ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager_<span class="token punctuation">;</span>
    <span class="token comment">// States</span>
    <span class="token keyword">bool</span> started_playing_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create virtual input system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>ecs<span class="token operator">::</span>virtual_input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Define the buttons for the jump action</span>
        input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">{</span>input<span class="token operator">::</span>key<span class="token operator">::</span>space<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>w<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>up<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">{</span>input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>left<span class="token punctuation">,</span> input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>right<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">,</span> system_manager_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="collision-between-player-and-columns-death-and-game-reset"><a href="#collision-between-player-and-columns-death-and-game-reset" class="header-anchor">#</a> Collision Between Player and Columns, Death, and Game Reset</h2> <p>The game ends when the player flies into the columns and dies.</p> <p>Start by adding the collision system header <code>&lt;antara/gaming/collisions/basic.collision.system.hpp&gt;</code>.</p> <p>Make another logic system, <code>collision_logic</code>. The constructor receives the player entity and a reference to the <code>player_dead</code> variable, so that the collision result can be reported.</p> <p>Store both in the class as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
<span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died_<span class="token punctuation">;</span>
</code></pre></div><p>Create the class and constructor.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Collision Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">collision_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>collision_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">collision_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player_<span class="token punctuation">,</span> <span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died_<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                <span class="token function">player_</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                <span class="token function">player_died_</span><span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>Add a function to check for a collision between the player and the pipes, <code>check_player_pipe_collision</code>.</p> <p>Remember that columns are on <code>layer&lt;3&gt;</code>.</p> <p>Retrieve the columns by using the <code>view</code> function, <code>registry.view&lt;graphics::layer&lt;3&gt;&gt;()</code>.</p> <p>Use the <code>collisions::basic_collision_system::query_rect</code> function with <code>player_</code> and <code>entity</code>, which is the pipe.</p> <p>If a collision is detected, mark <code>player_died_</code> as <code>true</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Loop all columns to check collisions between player and the pipes</span>
<span class="token keyword">void</span> <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Check collision between player and a collidable object</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>collisions<span class="token operator">::</span>basic_collision_system<span class="token operator">::</span><span class="token function">query_rect</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> player_<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Mark player died as true</span>
            player_died_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call this function in the <code>update</code> function that is called every tick. However, if <code>player_died_</code> is <code>true</code>, there is no need to check for a collision; simply stop the function.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update, this will be called every tick</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
    <span class="token comment">// Do not check anything if player is already dead</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// Check collision</span>
    <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As before, name this system outside of the class.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>collision_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The completed class is as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Collision Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">collision_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>collision_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">collision_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player_<span class="token punctuation">,</span> <span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died_<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                <span class="token function">player_</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                <span class="token function">player_died_</span><span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Do not check anything if player is already dead</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">// Check collision</span>
        <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Loop all columns to check collisions between player and the pipes</span>
    <span class="token keyword">void</span> <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Check collision between player and a collidable object</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>collisions<span class="token operator">::</span>basic_collision_system<span class="token operator">::</span><span class="token function">query_rect</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> player_<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Mark player died as true</span>
                player_died_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>collision_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Add the class to the game scene.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create logic systems</span>
<span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
    system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>collision_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> player_died_<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Add a few more state variables for player death, game over, and reset query.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// States</span>
<span class="token keyword">bool</span> started_playing_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> player_died_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> game_over_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> need_reset_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Add the needed values for game restart to <code>reset_state_variables</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Reset state values</span>
<span class="token keyword">void</span> <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    started_playing_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    player_died_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    game_over_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Since <code>player_died_</code> is filled by <code>collision_logic</code>, the logic can read the value within this class.</p> <p>When the value is <code>true</code>, mark <code>game_over_</code> as <code>true</code> and pause physics. This stops the game when the player dies. Mark <code>player_died_</code> to <code>false</code> here also, so that these functions are not triggered again.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Check if the player died</span>
<span class="token keyword">void</span> <span class="token function">check_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If the player died, game over, and pause physics</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        player_died_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        game_over_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">pause_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Another function checks for a jump button press after the game is over.</p> <p>When the jump button is pressed, the game restarts.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Check if reset is requested at game over state</span>
<span class="token keyword">void</span> <span class="token function">check_reset_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If game is over, and jump key is pressed, reset game</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>game_over_ <span class="token operator">&amp;&amp;</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Call these two functions in the <code>update</code> function.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update the game every tick</span>
<span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token comment">// Check if player requested to start the game</span>
    <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Check if the player died</span>
    <span class="token function">check_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Check if player requested reset after death</span>
    <span class="token function">check_reset_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Defin the <code>reset_game</code> function.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Reset game</span>
<span class="token keyword">void</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Destroy all dynamic objects</span>
    <span class="token function">destroy_dynamic_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Queue reset to reinitialize</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>need_reset_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>reset_game</code> function destroys dynamic objects.</p> <p>To achieve this, retrieve all the dynamic entities with the <code>dynamic</code> tag that were set previously, then destroy them using the registry.</p> <p>For the logic system deletions, mark items for deletion with the function below.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Destroy dynamic objects</span>
<span class="token keyword">void</span> <span class="token function">destroy_dynamic_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve the collection of entities from the game scene</span>
    <span class="token keyword">auto</span> view <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Iterate the collection and destroy each entities</span>
    entity_registry_<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Delete systems</span>
    system_manager_<span class="token punctuation">.</span>mark_systems<span class="token operator">&lt;</span>player_logic<span class="token punctuation">,</span> collision_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Those systems are deleted after the whole update tick is completed. They should no be reinitialize in <code>reset_game</code>. Instead, queue the reset by setting <code>need_reset_</code> to <code>true</code>, and reinitialize in the <code>post_update</code> function, as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Post update</span>
<span class="token keyword">void</span> <span class="token function">post_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
    <span class="token comment">// If reset is requested</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>need_reset_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Reinitialize all these</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        need_reset_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Flappy Bird now collides with pipes, dies, and enters the “game over” state. Afterwards, by pressing the jump button, all the dynamic entities and logic systems are destroyed, then reinitialized.</p> <p>Here is the full code up to this point in the tutorial.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/ecs/virtual.input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/collisions/basic.collision.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.layer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.canvas.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/math/vector.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.sprite.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/input/virtual.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Player</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>string player_image_name<span class="token punctuation">{</span><span class="token string">&quot;player.png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> player_pos_x<span class="token punctuation">{</span><span class="token number">400.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gravity<span class="token punctuation">{</span><span class="token number">2000.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> jump_force<span class="token punctuation">{</span><span class="token number">650.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> rotate_speed<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> max_angle<span class="token punctuation">{</span><span class="token number">60.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> scroll_speed<span class="token punctuation">{</span><span class="token number">200.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Background</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> ground_thickness<span class="token punctuation">{</span><span class="token number">100.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> grass_thickness<span class="token punctuation">{</span><span class="token number">20.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color background_color<span class="token punctuation">{</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color ground_color<span class="token punctuation">{</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color grass_color<span class="token punctuation">{</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color grass_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Logic functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Returns a random gap start position Y</span>
    <span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
        <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Factory functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
    pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE BODY</span>
        <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
        transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is the column thickness,</span>
        <span class="token comment">// Size Y is the important part.</span>
        <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
        <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
        <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
        <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
        <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
        math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                              is_top <span class="token operator">?</span>
                              gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                              <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                                  constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE CAP</span>
        <span class="token comment">// Prepare the pipe cap</span>
        <span class="token comment">// Size of the cap is defined in constants</span>
        math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
        <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
        transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       is_top <span class="token operator">?</span>
                                       gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                       gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the cap</span>
        <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                                 constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set layers, cap should be in front of body</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct a pipe with body and cap and return it</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory to create single column</span>
    <span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a fresh entity for a new column</span>
        <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get a random gap start position Y, between pipes</span>
        <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
        <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird columns</span>
    <span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
            <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird background</span>
    <span class="token keyword">void</span> <span class="token function">create_background</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create Sky</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// The size is the full canvas</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Grass</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                                                       constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Ground</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating the player</span>
    entt<span class="token operator">::</span>entity <span class="token function">create_player</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> entity <span class="token operator">=</span> graphics<span class="token operator">::</span><span class="token function">blueprint_sprite</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span>
                                                 graphics<span class="token operator">::</span>sprite<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_image_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                 transform<span class="token operator">::</span>position_2d<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_pos_x<span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>antara<span class="token operator">::</span>gaming<span class="token operator">::</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;player&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Column Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">column_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">column_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Loop all columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Move pipes, and retrieve column position x</span>
            <span class="token keyword">float</span> column_pos_x <span class="token operator">=</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Test whether column is out of the screen</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Remove this column</span>
                col<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Create a new column at far end</span>
                <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Find the furthest pipe's position X</span>
    <span class="token keyword">float</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> furthest <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> x <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> furthest<span class="token punctuation">)</span> furthest <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> furthest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Move the pipe and return the x position</span>
    <span class="token keyword">float</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> pipe <span class="token operator">&amp;</span>pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the pipe</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Shift pos X to the left by scroll_speed, but multiply the value by dt, as this occurs many times per second</span>
        <span class="token comment">// Delta time ensures that the movement occurs over time, so that over the course of one second the movement covers scroll_speed pixels</span>
        <span class="token keyword">auto</span> new_pos_x <span class="token operator">=</span> pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> constants<span class="token punctuation">.</span>scroll_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set cap position too</span>
        <span class="token keyword">auto</span> cap_pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> cap_pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Return the information about whether this pipe is out of the screen</span>
        <span class="token keyword">return</span> new_pos_x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>column_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Player Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">player_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">player_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">player_</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the player</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Add gravity to movement speed, multiply with delta time to apply it over time</span>
        movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span>movement_speed_<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>gravity <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if jump key is tapped</span>
        <span class="token keyword">bool</span> jump_key_tapped <span class="token operator">=</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If jump is tapped, jump by adding jump force to the movement speed Y</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span> movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token operator">-</span>constants<span class="token punctuation">.</span>jump_force<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Add movement speed to position to make the character move, but apply over time with delta time</span>
        pos <span class="token operator">+=</span> movement_speed_ <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Do not let player to go out of the screen to top</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0.f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pos<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ROTATION</span>
        <span class="token comment">// Retrieve props of the player</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>props <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Increase the rotation a little by applying delta time</span>
        <span class="token keyword">float</span> new_rotation <span class="token operator">=</span> props<span class="token punctuation">.</span>rotation <span class="token operator">+</span> constants<span class="token punctuation">.</span>rotate_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If jump button is tapped, reset rotation,</span>
        <span class="token comment">// If rotation is higher than the max angle, set it to max angle</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span>
            new_rotation <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>rotation <span class="token operator">&gt;</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">)</span>
            new_rotation <span class="token operator">=</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">;</span>
        <span class="token comment">// Set the properties</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> transform<span class="token operator">::</span>properties<span class="token punctuation">{</span><span class="token punctuation">.</span>rotation <span class="token operator">=</span> new_rotation<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
    math<span class="token operator">::</span>vec2f movement_speed_<span class="token punctuation">{</span><span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>player_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Collision Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">collision_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>collision_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">collision_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player<span class="token punctuation">,</span> <span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                   <span class="token function">player_</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                   <span class="token function">player_died_</span><span class="token punctuation">(</span>player_died<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Do not check anything if player is already dead</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">// Check collision</span>
        <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Loop all columns to check collisions between player and the pipes</span>
    <span class="token keyword">void</span> <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Check collision between player and a collidable object</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>collisions<span class="token operator">::</span>basic_collision_system<span class="token operator">::</span><span class="token function">query_rect</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> player_<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Mark player died as true</span>
                player_died_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>collision_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                          <span class="token function">system_manager_</span><span class="token punctuation">(</span>system_manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create everything</span>
        <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token comment">// Check if player requested to start the game</span>
        <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if the player died</span>
        <span class="token function">check_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if player requested reset after death</span>
        <span class="token function">check_reset_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check if start game is requested at the pause state</span>
    <span class="token keyword">void</span> <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If game is not started yet and jump key is tapped</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started_playing_ <span class="token operator">&amp;&amp;</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Game starts, player started playing</span>
            started_playing_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check if the player died</span>
    <span class="token keyword">void</span> <span class="token function">check_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If the player died, game over, and pause physics</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            player_died_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            game_over_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">pause_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check if reset is requested at game over state</span>
    <span class="token keyword">void</span> <span class="token function">check_reset_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If game is over, and jump key is pressed, reset game</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>game_over_ <span class="token operator">&amp;&amp;</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
    <span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create player</span>
        <span class="token keyword">auto</span> player <span class="token operator">=</span> <span class="token function">create_player</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create logic systems</span>
        <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Reset state variables</span>
        <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>collision_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> player_died_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Reset state values</span>
    <span class="token keyword">void</span> <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        started_playing_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        player_died_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        game_over_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Pause physics</span>
    <span class="token keyword">void</span> <span class="token function">pause_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>disable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Resume physics</span>
    <span class="token keyword">void</span> <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>enable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Destroy dynamic objects</span>
    <span class="token keyword">void</span> <span class="token function">destroy_dynamic_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve the collection of entities from the game scene</span>
        <span class="token keyword">auto</span> view <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Iterate the collection and destroy each entities</span>
        entity_registry_<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Delete systems</span>
        system_manager_<span class="token punctuation">.</span>mark_systems<span class="token operator">&lt;</span>player_logic<span class="token punctuation">,</span> collision_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Reset game</span>
    <span class="token keyword">void</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Destroy all dynamic objects</span>
        <span class="token function">destroy_dynamic_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Queue reset to reinitialize</span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>need_reset_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Post update</span>
    <span class="token keyword">void</span> <span class="token function">post_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token comment">// If reset is requested</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>need_reset_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Reinitialize all these</span>
            <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
            need_reset_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// System manager reference</span>
    ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager_<span class="token punctuation">;</span>
    <span class="token comment">// States</span>
    <span class="token keyword">bool</span> started_playing_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> player_died_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> game_over_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> need_reset_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create virtual input system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>ecs<span class="token operator">::</span>virtual_input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Define the buttons for the jump action</span>
        input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">{</span>input<span class="token operator">::</span>key<span class="token operator">::</span>space<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>w<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>up<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">{</span>input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>left<span class="token punctuation">,</span> input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>right<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">,</span> system_manager_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="score-and-ui"><a href="#score-and-ui" class="header-anchor">#</a> Score and UI</h2> <p>Without scores there is no measure of achievement, and no motivation to play again for improvement.</p> <p>Only one constant is needed: <code>font_size</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// UI</span>
    <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> font_size<span class="token punctuation">{</span><span class="token number">32ull</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="creating-the-score"><a href="#creating-the-score" class="header-anchor">#</a> Creating the Score</h4> <p>The score increases by one each time the player passes a column.</p> <p>Mark a passed column as <code>scored</code>. Put a variable into the <code>struct column</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Is score taken from this column</span>
<span class="token keyword">bool</span> scored<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Define a score struct that has the current score, max score, and UI text.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Score struct, has current value, max record, and the UI text</span>
<span class="token keyword">struct</span> <span class="token class-name">score</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> value<span class="token punctuation">;</span>
    <span class="token keyword">int</span> max_score<span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity text<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Make a function which constructs the UI text and places it under logic functions, <code>namespace</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create the UI string</span>
std<span class="token operator">::</span>string <span class="token function">score_ui_text</span><span class="token punctuation">(</span><span class="token keyword">int</span> score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> best_score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Score: &quot;</span>s <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token operator">+</span>
           <span class="token string">&quot;\nBest: &quot;</span>s <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>best_score<span class="token punctuation">)</span> <span class="token operator">+</span>
           <span class="token string">&quot;\n\nW / UP / Space / Mouse to FLAP&quot;</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Make the <code>create_score</code> function that makes an entity.</p> <p>Retrieve constants and canvas size.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Factory to create score entity</span>
entt<span class="token operator">::</span>entity <span class="token function">create_score</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Retrieve constants</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="create-the-text"><a href="#create-the-text" class="header-anchor">#</a> Create the Text</h4> <p>Create <code>text_entity</code> using the <code>graphics::blueprint_text</code> function, feed the text <code>score_ui_text</code> and <code>font_size</code> from <code>constants</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create text</span>
<span class="token keyword">auto</span> text_entity <span class="token operator">=</span> graphics<span class="token operator">::</span><span class="token function">blueprint_text</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> graphics<span class="token operator">::</span>text<span class="token punctuation">{</span><span class="token function">score_ui_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>font_size<span class="token punctuation">}</span><span class="token punctuation">,</span>
    transform<span class="token operator">::</span>position_2d<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.03f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.03f</span><span class="token punctuation">}</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>white<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Set the layer to <code>layer&lt;9&gt;</code>, as the text must be in front of everything. Tag the text as <code>game_scene</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">9</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>text_entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> text_entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Create a fresh entity and assign <code>struct score</code> to it with <code>0</code> score, max record values, and the <code>text_entity</code> value. Tag this entity as <code>high_score</code> and <code>game_scene</code>, then return it.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Create a fresh entity</span>
<span class="token keyword">auto</span> entity <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Create score</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>score<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> text_entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;high_score&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> entity<span class="token punctuation">;</span>
</code></pre></div><p>Add a member for the entity in <code>game_scene</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>entt<span class="token operator">::</span>entity score_entity_<span class="token punctuation">;</span>
</code></pre></div><p>Create the entity inside the <code>game_scene</code> constructor using the <code>create_score</code> function.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                      <span class="token function">system_manager_</span><span class="token punctuation">(</span>system_manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Set the constants that will be used in the program</span>
    registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create everything</span>
    score_entity_ <span class="token operator">=</span> <span class="token function">create_score</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="updating-the-score"><a href="#updating-the-score" class="header-anchor">#</a> Updating the Score</h4> <p>Make the function that updates the score.</p> <p>This function does two things: increment the score by one and reset the score when the game is reset.</p> <p>This requires a parameter, <code>reset</code>, for information about the reset.</p> <p>To achieve this, retrieve the <code>struct score</code> from the entity. If a reset is requested, set the <code>value</code> to zero.</p> <p>If a reset is not requested, increment the <code>value</code> by one, check whether the value is higher than the <code>max_score</code>, and update the <code>max_score</code> if this is the case.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">update_score</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> reset <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    score <span class="token operator">&amp;</span>sc <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>score<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If reset is asked, set score to 0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> sc<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// Else, increase the score,</span>
        <span class="token comment">// Compare it with the max score, and update max score if it's greater</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>sc<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> sc<span class="token punctuation">.</span>max_score<span class="token punctuation">)</span> sc<span class="token punctuation">.</span>max_score <span class="token operator">=</span> sc<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
</code></pre></div><p>Update the <code>struct score</code> inside the score entity.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update the score entity</span>
registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>score<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Update the contents of <code>graphics::text</code> with the <code>score_ui_text</code> using the new values.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update the UI text entity with the current values</span>
<span class="token keyword">auto</span> <span class="token operator">&amp;</span>text <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>text<span class="token operator">&gt;</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
text<span class="token punctuation">.</span>contents <span class="token operator">=</span> <span class="token function">score_ui_text</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>value<span class="token punctuation">,</span> sc<span class="token punctuation">.</span>max_score<span class="token punctuation">)</span><span class="token punctuation">;</span>
registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>text<span class="token operator">&gt;</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>text<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The completed function is as follows.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Update score</span>
<span class="token keyword">void</span> <span class="token function">update_score</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> reset <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    score <span class="token operator">&amp;</span>sc <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>score<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If reset is asked, set score to 0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reset<span class="token punctuation">)</span> sc<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// Else, increase the score,</span>
        <span class="token comment">// Compare it with the max score, and update max score if it's greater</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>sc<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> sc<span class="token punctuation">.</span>max_score<span class="token punctuation">)</span> sc<span class="token punctuation">.</span>max_score <span class="token operator">=</span> sc<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token comment">// Update the score entity</span>
    registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>score<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Update the UI text entity with the current values</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>text <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>text<span class="token operator">&gt;</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    text<span class="token punctuation">.</span>contents <span class="token operator">=</span> <span class="token function">score_ui_text</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>value<span class="token punctuation">,</span> sc<span class="token punctuation">.</span>max_score<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>text<span class="token operator">&gt;</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>text<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The function must be called when the player passes a column. The function needs the score entity. Pass the function to <code>column_logic</code> with the constructor.</p> <p>The first step is to have a class member for entity.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>entt<span class="token operator">::</span>entity score_entity_<span class="token punctuation">;</span>
</code></pre></div><p>Then fill this with the constructor.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Column Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">column_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">column_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity score<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                <span class="token function">score_entity_</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Update the creation line also, feeding the score entity.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>score_entity_<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Return to the <code>update</code> function of this class and, inside the <code>for</code> loop that loops through all columns, add the check for the score.</p> <p>At first the column should be new with the <code>score</code> field set to <code>false</code>.</p> <p>Once the column position is to the left side of the player position (after the player passes), use a simple <code>&lt;</code> comparison of the column and the player’s position on the <code>X</code> axis.</p> <p>Inside, call the <code>update_score</code> function and mark the column <code>scored</code> as <code>true</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// If this column is not scored and if the player passed this column</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>col<span class="token punctuation">.</span>scored <span class="token operator">&amp;&amp;</span> column_pos_x <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>player_pos_x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Increase the score</span>
    <span class="token function">update_score</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> score_entity_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Set column as scored</span>
    col<span class="token punctuation">.</span>scored <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="reset-the-score-value-at-game-over"><a href="#reset-the-score-value-at-game-over" class="header-anchor">#</a> Reset the Score Value at Game Over</h4> <p>Reset this score value when the game is over and <code>reset_game</code> is called.</p> <p>Use the <code>update_score</code> function to this effect, but this time set the last parameter, <code>reset</code>, as <code>true</code>.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Reset game</span>
<span class="token keyword">void</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Destroy all dynamic objects</span>
    <span class="token function">destroy_dynamic_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Queue reset to reinitialize</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>need_reset_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// Reset current score, but keep the max score</span>
    <span class="token function">update_score</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">,</span> score_entity_<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A visual example of the result.</p> <div><img src="/flappy-bird-tutorial/fb_score.png"></div> <p>Here is the full code.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/ecs/virtual.input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/collisions/basic.collision.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.layer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.canvas.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/math/vector.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/scenes/scene.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/graphic.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/input.system.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/sfml/resources.manager.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/world/world.app.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/graphics/component.sprite.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;antara/gaming/input/virtual.hpp&gt;</span></span>
<span class="token comment">// For convenience</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> antara<span class="token operator">::</span>gaming<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token operator">::</span>string_literals<span class="token punctuation">;</span>
<span class="token comment">// Constants</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_constants</span> <span class="token punctuation">{</span>
    <span class="token comment">// Player</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>string player_image_name<span class="token punctuation">{</span><span class="token string">&quot;player.png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> player_pos_x<span class="token punctuation">{</span><span class="token number">400.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gravity<span class="token punctuation">{</span><span class="token number">2000.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> jump_force<span class="token punctuation">{</span><span class="token number">650.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> rotate_speed<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> max_angle<span class="token punctuation">{</span><span class="token number">60.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Pipes</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> gap_height<span class="token punctuation">{</span><span class="token number">265.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_start_distance<span class="token punctuation">{</span><span class="token number">700.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_min<span class="token punctuation">{</span><span class="token number">0.2f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_max<span class="token punctuation">{</span><span class="token number">0.8f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_thickness<span class="token punctuation">{</span><span class="token number">100.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> column_distance<span class="token punctuation">{</span><span class="token number">400.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>size_t column_count<span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_extra_width<span class="token punctuation">{</span><span class="token number">10.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> pipe_cap_height<span class="token punctuation">{</span><span class="token number">50.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color pipe_color<span class="token punctuation">{</span><span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color pipe_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> scroll_speed<span class="token punctuation">{</span><span class="token number">200.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Background</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> ground_thickness<span class="token punctuation">{</span><span class="token number">100.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> grass_thickness<span class="token punctuation">{</span><span class="token number">20.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color background_color<span class="token punctuation">{</span><span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color ground_color<span class="token punctuation">{</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>color grass_color<span class="token punctuation">{</span><span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> graphics<span class="token operator">::</span>outline_color grass_outline_color<span class="token punctuation">{</span><span class="token number">2.0f</span><span class="token punctuation">,</span> graphics<span class="token operator">::</span>color<span class="token punctuation">{</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Random number generator</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>random_device rd<span class="token punctuation">;</span>  <span class="token comment">// Will be used to obtain a seed for the random number engine</span>
    std<span class="token operator">::</span>mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Standard mersenne_twister_engine seeded with rd()</span>
    <span class="token keyword">float</span> <span class="token function">random_float</span><span class="token punctuation">(</span><span class="token keyword">float</span> lower<span class="token punctuation">,</span> <span class="token keyword">float</span> higher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token operator">::</span>uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">dist</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> higher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// A Flappy Bird column which has two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">pipe</span> <span class="token punctuation">{</span>
    entt<span class="token operator">::</span>entity body<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    entt<span class="token operator">::</span>entity cap<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipe</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Column is made of two pipes</span>
<span class="token keyword">struct</span> <span class="token class-name">column</span> <span class="token punctuation">{</span>
    <span class="token comment">// Entities representing the Flappy Bird pipes</span>
    pipe top_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    pipe bottom_pipe<span class="token punctuation">{</span>entt<span class="token operator">::</span>null<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Destroy pipes and this column</span>
    <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        top_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bottom_pipe<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Logic functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity entity<span class="token punctuation">,</span> <span class="token keyword">bool</span> dynamic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag game scene</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;game_scene&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tag dynamic</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Returns a random gap start position Y</span>
    <span class="token keyword">float</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> top_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_min<span class="token punctuation">;</span>
        <span class="token keyword">float</span> bottom_limit <span class="token operator">=</span> canvas_height <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_max <span class="token operator">-</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">random_float</span><span class="token punctuation">(</span>top_limit<span class="token punctuation">,</span> bottom_limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Factory functions</span>
<span class="token keyword">namespace</span> <span class="token punctuation">{</span>
    <span class="token comment">// Factory for pipes. This requires information about whether the pipe is a top pipe, and the position x of the column, and the starting gap position Y</span>
    pipe <span class="token function">create_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">bool</span> is_top<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">,</span> <span class="token keyword">float</span> gap_start_pos_y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> canvas_height <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE BODY</span>
        <span class="token comment">// Top pipe is at Y: 0 and bottom pipe is at canvas_height, bottom of the canvas</span>
        transform<span class="token operator">::</span>position_2d body_pos<span class="token punctuation">{</span>pos_x<span class="token punctuation">,</span> is_top <span class="token operator">?</span> <span class="token number">0.f</span> <span class="token operator">:</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Size X is the column thickness,</span>
        <span class="token comment">// Size Y is the important part.</span>
        <span class="token comment">// If this is a top pipe, gap_start_pos_y is the bottom of the rectangle</span>
        <span class="token comment">//  Half size is gap_start_pos_y since the center of the rectangle is at 0</span>
        <span class="token comment">// If this is the bottom pipe, the top of the rectangle is at gap_start_pos_y + gap_height</span>
        <span class="token comment">//  Half size is canvas_height - (gap_start_pos_y + gap_height)</span>
        <span class="token comment">// Since these are half-sizes, and the position is at the screen border, multiply these sizes by two</span>
        math<span class="token operator">::</span>vec2f body_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness<span class="token punctuation">,</span>
                              is_top <span class="token operator">?</span>
                              gap_start_pos_y <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">:</span>
                              <span class="token punctuation">(</span>canvas_height <span class="token operator">-</span> <span class="token punctuation">(</span>gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> body <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> body_pos<span class="token punctuation">,</span>
                                                  constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// PIPE CAP</span>
        <span class="token comment">// Prepare the pipe cap</span>
        <span class="token comment">// Size of the cap is defined in constants</span>
        math<span class="token operator">::</span>vec2f cap_size<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>column_thickness <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_extra_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_cap_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Position X is the same as the body. The bottom of the cap is aligned with the bottom of the body,</span>
        <span class="token comment">// or start of the gap, use the start of the gap minus half of the cap height</span>
        transform<span class="token operator">::</span>position_2d cap_pos<span class="token punctuation">{</span>body_pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       is_top <span class="token operator">?</span>
                                       gap_start_pos_y <span class="token operator">-</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span> <span class="token operator">:</span>
                                       gap_start_pos_y <span class="token operator">+</span> constants<span class="token punctuation">.</span>gap_height <span class="token operator">+</span> constants<span class="token punctuation">.</span>pipe_cap_height <span class="token operator">*</span> <span class="token number">0.5f</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the cap</span>
        <span class="token keyword">auto</span> cap <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap_size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>pipe_color<span class="token punctuation">,</span> cap_pos<span class="token punctuation">,</span>
                                                 constants<span class="token punctuation">.</span>pipe_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set layers, cap should be in front of body</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> cap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> body<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct a pipe with body and cap and return it</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>body<span class="token punctuation">,</span> cap<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory to create single column</span>
    <span class="token keyword">void</span> <span class="token function">create_column</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> <span class="token keyword">float</span> pos_x<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create a fresh entity for a new column</span>
        <span class="token keyword">auto</span> entity_column <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get a random gap start position Y, between pipes</span>
        <span class="token keyword">float</span> gap_start_pos_y <span class="token operator">=</span> <span class="token function">get_random_gap_start_pos</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create pipes, is_top variable is false for bottom one</span>
        <span class="token keyword">auto</span> top_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> bottom_pipe <span class="token operator">=</span> <span class="token function">create_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pos_x<span class="token punctuation">,</span> gap_start_pos_y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Make a column from these two pipes and mark it as &quot;column&quot;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">,</span> top_pipe<span class="token punctuation">,</span> bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;column&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity_column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity_column<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird columns</span>
    <span class="token keyword">void</span> <span class="token function">create_columns</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Spawn columns out of the screen, out of the canvas</span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> column_pos_offset <span class="token operator">=</span> constants<span class="token punctuation">.</span>column_start_distance <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> constants<span class="token punctuation">.</span>column_count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Horizontal position (X) increases for every column, keeping the distance</span>
            <span class="token keyword">float</span> pos_x <span class="token operator">=</span> column_pos_offset <span class="token operator">+</span> i <span class="token operator">*</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">;</span>
            <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> pos_x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating a Flappy Bird background</span>
    <span class="token keyword">void</span> <span class="token function">create_background</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create Sky</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The sky is the whole canvas, so the position is in the middle of the canvas</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// The size is the full canvas</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> canvas_height<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> sky <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>background_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sky<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Grass</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the top of the ground, so the height of the ground is canvas_height minus ground_thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            <span class="token comment">// Make the rectangle longer by adding the thickness of the outline to hide the outline at the sides</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width <span class="token operator">+</span> constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">.</span>thickness <span class="token operator">*</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> grass <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>grass_color<span class="token punctuation">,</span> pos<span class="token punctuation">,</span>
                                                       constants<span class="token punctuation">.</span>grass_outline_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> grass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create Ground</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// The ground expands to the whole canvas width, so the position is in the center X value of the canvas,</span>
            <span class="token comment">// Position Y is at the bottom of the screen, so the height is the full canvas_height minus half of the ground thickness</span>
            transform<span class="token operator">::</span>position_2d pos<span class="token punctuation">{</span>canvas_width <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> canvas_height <span class="token operator">-</span> constants<span class="token punctuation">.</span>ground_thickness <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// Size X is full canvas but the height is defined in constants</span>
            math<span class="token operator">::</span>vec2f size<span class="token punctuation">{</span>canvas_width<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_thickness<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> ground <span class="token operator">=</span> geometry<span class="token operator">::</span><span class="token function">blueprint_rectangle</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> size<span class="token punctuation">,</span> constants<span class="token punctuation">.</span>ground_color<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> ground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Factory for creating the player</span>
    entt<span class="token operator">::</span>entity <span class="token function">create_player</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span> canvas_height<span class="token punctuation">]</span> <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>canvas_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> entity <span class="token operator">=</span> graphics<span class="token operator">::</span><span class="token function">blueprint_sprite</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span>
                                                 graphics<span class="token operator">::</span>sprite<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_image_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                                 transform<span class="token operator">::</span>position_2d<span class="token punctuation">{</span>constants<span class="token punctuation">.</span>player_pos_x<span class="token punctuation">,</span> canvas_height <span class="token operator">*</span> <span class="token number">0.5f</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>antara<span class="token operator">::</span>gaming<span class="token operator">::</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>assign<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;player&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">tag_game_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Column Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">column_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">column_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Loop all columns</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Move pipes, and retrieve column position x</span>
            <span class="token keyword">float</span> column_pos_x <span class="token operator">=</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">move_pipe</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> col<span class="token punctuation">.</span>bottom_pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Test whether column is out of the screen</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>column_pos_x <span class="token operator">&lt;</span> <span class="token operator">-</span>constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Remove this column</span>
                col<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Create a new column at far end</span>
                <span class="token function">create_column</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>column_distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Find the furthest pipe's position X</span>
    <span class="token keyword">float</span> <span class="token function">furthest_pipe_position</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> furthest <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">auto</span> <span class="token operator">&amp;</span>col <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>column<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> x <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>top_pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> furthest<span class="token punctuation">)</span> furthest <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> furthest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Move the pipe and return the x position</span>
    <span class="token keyword">float</span> <span class="token function">move_pipe</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> pipe <span class="token operator">&amp;</span>pipe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the pipe</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Shift pos X to the left by scroll_speed, but multiply the value by dt, as this occurs many times per second</span>
        <span class="token comment">// Delta time ensures that the movement occurs over time, so that over the course of one second the movement covers scroll_speed pixels</span>
        <span class="token keyword">auto</span> new_pos_x <span class="token operator">=</span> pos<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> constants<span class="token punctuation">.</span>scroll_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>body<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set cap position too</span>
        <span class="token keyword">auto</span> cap_pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>pipe<span class="token punctuation">.</span>cap<span class="token punctuation">,</span> new_pos_x<span class="token punctuation">,</span> cap_pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Return the information about whether this pipe is out of the screen</span>
        <span class="token keyword">return</span> new_pos_x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>column_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Player Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">player_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">player_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">player_</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Retrieve constants</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span> constants <span class="token operator">=</span> registry<span class="token punctuation">.</span>ctx<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get current position of the player</span>
        <span class="token keyword">auto</span> pos <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Add gravity to movement speed, multiply with delta time to apply it over time</span>
        movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span>movement_speed_<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> constants<span class="token punctuation">.</span>gravity <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if jump key is tapped</span>
        <span class="token keyword">bool</span> jump_key_tapped <span class="token operator">=</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If jump is tapped, jump by adding jump force to the movement speed Y</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span> movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token operator">-</span>constants<span class="token punctuation">.</span>jump_force<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Add movement speed to position to make the character move, but apply over time with delta time</span>
        pos <span class="token operator">+=</span> movement_speed_ <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Do not let player to go out of the screen to top</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0.f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pos<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            movement_speed_<span class="token punctuation">.</span><span class="token function">set_y</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Set the new position value</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>position_2d<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ROTATION</span>
        <span class="token comment">// Retrieve props of the player</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>props <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Increase the rotation a little by applying delta time</span>
        <span class="token keyword">float</span> new_rotation <span class="token operator">=</span> props<span class="token punctuation">.</span>rotation <span class="token operator">+</span> constants<span class="token punctuation">.</span>rotate_speed <span class="token operator">*</span> timer<span class="token operator">::</span>time_step<span class="token operator">::</span><span class="token function">get_fixed_delta_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If jump button is tapped, reset rotation,</span>
        <span class="token comment">// If rotation is higher than the max angle, set it to max angle</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jump_key_tapped<span class="token punctuation">)</span>
            new_rotation <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>rotation <span class="token operator">&gt;</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">)</span>
            new_rotation <span class="token operator">=</span> constants<span class="token punctuation">.</span>max_angle<span class="token punctuation">;</span>
        <span class="token comment">// Set the properties</span>
        registry<span class="token punctuation">.</span>replace<span class="token operator">&lt;</span>transform<span class="token operator">::</span>properties<span class="token operator">&gt;</span><span class="token punctuation">(</span>player_<span class="token punctuation">,</span> transform<span class="token operator">::</span>properties<span class="token punctuation">{</span><span class="token punctuation">.</span>rotation <span class="token operator">=</span> new_rotation<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
    math<span class="token operator">::</span>vec2f movement_speed_<span class="token punctuation">{</span><span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>player_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Collision Logic System</span>
<span class="token keyword">class</span> <span class="token class-name">collision_logic</span> final <span class="token operator">:</span> <span class="token keyword">public</span> ecs<span class="token operator">::</span>logic_update_system<span class="token operator">&lt;</span>collision_logic<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">collision_logic</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> entt<span class="token operator">::</span>entity player<span class="token punctuation">,</span> <span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">system</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                   <span class="token function">player_</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                                   <span class="token function">player_died_</span><span class="token punctuation">(</span>player_died<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// Update, this will be called every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>registry <span class="token operator">=</span> entity_registry_<span class="token punctuation">;</span>
        <span class="token comment">// Do not check anything if player is already dead</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">// Check collision</span>
        <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Loop all columns to check collisions between player and the pipes</span>
    <span class="token keyword">void</span> <span class="token function">check_player_pipe_collision</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> entity <span class="token operator">:</span> registry<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>graphics<span class="token operator">::</span>layer<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Check collision between player and a collidable object</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>collisions<span class="token operator">::</span>basic_collision_system<span class="token operator">::</span><span class="token function">query_rect</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> player_<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Mark player died as true</span>
                player_died_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    entt<span class="token operator">::</span>entity player_<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> <span class="token operator">&amp;</span>player_died_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Name this system</span>
<span class="token function">REFL_AUTO</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>collision_logic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Game Scene</span>
<span class="token keyword">class</span> <span class="token class-name">game_scene</span> final <span class="token operator">:</span> <span class="token keyword">public</span> scenes<span class="token operator">::</span>base_scene <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">game_scene</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">,</span> ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">base_scene</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                                          <span class="token function">system_manager_</span><span class="token punctuation">(</span>system_manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the constants that will be used in the program</span>
        registry<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>flappy_bird_constants<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create everything</span>
        <span class="token function">create_background</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Scene name</span>
    std<span class="token operator">::</span>string <span class="token function">scene_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;game_scene&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// Update the game every tick</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token comment">// Check if player requested to start the game</span>
        <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if the player died</span>
        <span class="token function">check_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Check if player requested reset after death</span>
        <span class="token function">check_reset_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check if start game is requested at the pause state</span>
    <span class="token keyword">void</span> <span class="token function">check_start_game_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If game is not started yet and jump key is tapped</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started_playing_ <span class="token operator">&amp;&amp;</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Game starts, player started playing</span>
            started_playing_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check if the player died</span>
    <span class="token keyword">void</span> <span class="token function">check_death</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If the player died, game over, and pause physics</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>player_died_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            player_died_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            game_over_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">pause_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check if reset is requested at game over state</span>
    <span class="token keyword">void</span> <span class="token function">check_reset_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If game is over, and jump key is pressed, reset game</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>game_over_ <span class="token operator">&amp;&amp;</span> input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">is_tapped</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Initialize dynamic objects, this function is called at start and resets</span>
    <span class="token keyword">void</span> <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>registry <span class="token operator">&amp;</span>registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">create_columns</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create player</span>
        <span class="token keyword">auto</span> player <span class="token operator">=</span> <span class="token function">create_player</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create logic systems</span>
        <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Reset state variables</span>
        <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create logic systems</span>
    <span class="token keyword">void</span> <span class="token function">create_logic_systems</span><span class="token punctuation">(</span>entt<span class="token operator">::</span>entity player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>column_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
        system_manager_<span class="token punctuation">.</span>create_system_rt<span class="token operator">&lt;</span>collision_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> player_died_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Reset state values</span>
    <span class="token keyword">void</span> <span class="token function">reset_state_variables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        started_playing_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        player_died_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        game_over_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Pause physics</span>
    <span class="token keyword">void</span> <span class="token function">pause_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>disable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Resume physics</span>
    <span class="token keyword">void</span> <span class="token function">resume_physics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        system_manager_<span class="token punctuation">.</span>enable_systems<span class="token operator">&lt;</span>column_logic<span class="token punctuation">,</span> player_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Destroy dynamic objects</span>
    <span class="token keyword">void</span> <span class="token function">destroy_dynamic_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Retrieve the collection of entities from the game scene</span>
        <span class="token keyword">auto</span> view <span class="token operator">=</span> entity_registry_<span class="token punctuation">.</span>view<span class="token operator">&lt;</span>entt<span class="token operator">::</span>tag<span class="token operator">&lt;</span><span class="token string">&quot;dynamic&quot;</span>_hs<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Iterate the collection and destroy each entities</span>
        entity_registry_<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Delete systems</span>
        system_manager_<span class="token punctuation">.</span>mark_systems<span class="token operator">&lt;</span>player_logic<span class="token punctuation">,</span> collision_logic<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Reset game</span>
    <span class="token keyword">void</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Destroy all dynamic objects</span>
        <span class="token function">destroy_dynamic_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Queue reset to reinitialize</span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>need_reset_ <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Post update</span>
    <span class="token keyword">void</span> <span class="token function">post_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> final <span class="token punctuation">{</span>
        <span class="token comment">// If reset is requested</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>need_reset_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Reinitialize all these</span>
            <span class="token function">init_dynamic_objects</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
            need_reset_ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// System manager reference</span>
    ecs<span class="token operator">::</span>system_manager <span class="token operator">&amp;</span>system_manager_<span class="token punctuation">;</span>
    <span class="token comment">// States</span>
    <span class="token keyword">bool</span> started_playing_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> player_died_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> game_over_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> need_reset_<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Game world</span>
<span class="token keyword">struct</span> <span class="token class-name">flappy_bird_world</span> <span class="token operator">:</span> <span class="token base-clause">world<span class="token operator">::</span><span class="token class-name">app</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Game entry point</span>
    <span class="token function">flappy_bird_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token comment">// Load the graphical system</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>graphic_system <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>graphic_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the resources system</span>
        entity_registry_<span class="token punctuation">.</span>set<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>resources_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the input system with the window from the graphical system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>sfml<span class="token operator">::</span>input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span>graphic_system<span class="token punctuation">.</span><span class="token function">get_window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create virtual input system</span>
        system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>ecs<span class="token operator">::</span>virtual_input_system<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Define the buttons for the jump action</span>
        input<span class="token operator">::</span>virtual_input<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;jump&quot;</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">{</span>input<span class="token operator">::</span>key<span class="token operator">::</span>space<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>w<span class="token punctuation">,</span> input<span class="token operator">::</span>key<span class="token operator">::</span>up<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">{</span>input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>left<span class="token punctuation">,</span> input<span class="token operator">::</span>mouse_button<span class="token operator">::</span>right<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Load the scenes manager</span>
        <span class="token keyword">auto</span> <span class="token operator">&amp;</span>scene_manager <span class="token operator">=</span> system_manager_<span class="token punctuation">.</span>create_system<span class="token operator">&lt;</span>scenes<span class="token operator">::</span>manager<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Change the current_scene to &quot;game_scene&quot; by pushing it.</span>
        scene_manager<span class="token punctuation">.</span><span class="token function">change_scene</span><span class="token punctuation">(</span>std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>game_scene<span class="token operator">&gt;</span><span class="token punctuation">(</span>entity_registry_<span class="token punctuation">,</span> system_manager_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Declare the world</span>
    flappy_bird_world game<span class="token punctuation">;</span>
    <span class="token comment">// Run the game</span>
    <span class="token keyword">return</span> game<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/komodoplatform/Documentation/edit/master/docs/basic-docs/antara/antara-tutorials/gaming-sdk-tutorial-4.md" target="_blank" rel="noopener noreferrer">Suggest an improvement for this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/developer-docs/assets/js/app.9ab3ad37.js" defer></script><script src="/developer-docs/assets/js/5.380bd526.js" defer></script><script src="/developer-docs/assets/js/3.9b0c7874.js" defer></script><script src="/developer-docs/assets/js/58.9fa16544.js" defer></script>
  </body>
</html>
